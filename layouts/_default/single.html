{{ define "main" }}
<div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8 py-8">
  <!-- ==== LEFT: ARTICLE CONTENT ==== -->
  <article class="prose prose-blue dark:prose-invert lg:col-span-2">
    <nav class="text-sm text-gray-500 dark:text-gray-400 mb-4">
      <a href="/" class="hover:text-[#0f7ea9] font-medium">Home</a>
      <span class="mx-2">/</span>
      {{ if eq .Section "blog" }}
        {{ $tag := index .Params.tags 0 }}
        {{ if $tag }}
          <a href="/tags/{{ $tag | urlize }}" class="hover:text-[#0f7ea9] font-medium">#{{ $tag }}</a>
        {{ else }}
          <a href="/blog" class="hover:text-[#0f7ea9] font-medium">#blog</a>
        {{ end }}
      {{ else }}
        <a href="/pages" class="hover:text-[#0f7ea9] font-medium">#pages</a>
      {{ end }}
    </nav>


    <h1>{{ .Title }}</h1>

    {{/* Social Share Icons under Title */}}
    {{ partial "social-share-header.html" . }}

    <!-- Artikel Content -->
    {{ $content := .Content }}
    {{ $paragraphs := split $content "</p>" }}
    
    {{/* Tampilkan 3 paragraf pertama */}}
    {{ range first 3 $paragraphs }}
      {{ . | safeHTML }}{{ if not (strings.HasSuffix . "</p>") }}</p>{{ end }}
    {{ end }}
    
    {{/* AdSense: Mid-Article (setelah 3 paragraf) */}}
    {{ if gt (len $paragraphs) 3 }}
      {{ partial "adsense-in-article.html" . }}
    {{ end }}
    
    {{/* Tampilkan sisa paragraf */}}
    {{ if gt (len $paragraphs) 3 }}
      {{ range after 3 $paragraphs }}
        {{ . | safeHTML }}{{ if not (strings.HasSuffix . "</p>") }}</p>{{ end }}
      {{ end }}
    {{ end }}

    <!-- Baca Juga -->
    <div class="bg-gray-100 dark:bg-gray-800 p-4 my-8 rounded">
      <h2 class="text-lg font-semibold mb-2">ðŸ“Œ Baca Juga</h2>
      <ul class="list-disc list-inside">
        {{ range first 3 (where .Site.RegularPages "Type" "blog") }}
        <li>
          <a
            href="{{ .RelPermalink }}"
            class="text-blue-600 dark:text-blue-400 hover:underline"
            >{{ .Title }}</a
          >
        </li>
        {{ end }}
      </ul>
    </div>

    {{/* Social Share Buttons */}}
    {{ partial "social-share.html" . }}

    {{/* AdSense: Responsive unit after related block */}}
    {{ partial "adsense-unit.html" . }}
  </article>

  <!-- ==== RIGHT: SIDEBAR ==== -->
  <aside class="space-y-10">
    <!-- POPULAR POST -->
    <div>
      <h3 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">
        Popular Post
      </h3>
      <ul
        class="space-y-3 list-disc list-inside text-sm text-gray-800 dark:text-gray-200"
      >
        {{ range first 5 (where .Site.RegularPages "Type" "blog") }}
        <li>
          <a href="{{ .RelPermalink }}" class="hover:text-[#0f7ea9] transition"
            >{{ .Title }}</a
          >
        </li>
        {{ end }}
      </ul>
    </div>

    <!-- Ads: Sidebar (desktop only) -->
    <div class="hidden lg:block mt-8">
      {{ partial "adsense-sidebar-300x250.html" . }}
    </div>
  </aside>
</div>
{{ if not .Params.disable_comments }}
{{ partial "comments.html" . }}
{{ end }}

{{/* Floating Share Button for Mobile */}}
{{ partial "social-share-compact.html" . }}

{{ end }}
