{{ define "main" }}
<div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8 py-8">
  <!-- ==== LEFT: ARTICLE CONTENT ==== -->
  <article class="prose prose-blue dark:prose-invert lg:col-span-2">
    <nav class="text-sm text-gray-500 dark:text-gray-400 mb-4">
      <a href="{{ "/" | relLangURL }}" class="hover:text-[#0f7ea9] font-medium">{{ i18n "home" }}</a>
      <span class="mx-2">/</span>
      {{ if eq .Section "blog" }}
        {{ $tag := index .Params.tags 0 }}
        {{ if $tag }}
          <a href="/tags/{{ $tag | urlize }}" class="hover:text-[#0f7ea9] font-medium">#{{ $tag }}</a>
        {{ else }}
          <a href="/blog" class="hover:text-[#0f7ea9] font-medium">#{{ i18n "blog" | lower }}</a>
        {{ end }}
      {{ else }}
        <a href="/pages" class="hover:text-[#0f7ea9] font-medium">#{{ i18n "pages" | lower }}</a>
      {{ end }}
    </nav>


    <h1>{{ .Title }}</h1>

    {{/* Language switcher for translated pages */}}
    {{ if .IsTranslated }}
    <div class="text-sm text-gray-500 dark:text-gray-400 mb-4">
      <span class="mr-2">{{ i18n "available_in" }}</span>
      {{ range .Translations }}
        <a href="{{ .RelPermalink }}" hreflang="{{ .Lang }}" class="underline hover:text-[#0f7ea9] mr-2">
          {{ if eq .Lang "id" }}Bahasa Indonesia{{ else if eq .Lang "en" }}English{{ else }}{{ upper .Lang }}{{ end }}
        </a>
      {{ end }}
    </div>
    {{ end }}

    {{/* Social Share Icons under Title */}}
    {{ partial "social-share-header.html" . }}

    <!-- Artikel Content -->
    {{ $content := .Content }}
    {{ $paragraphs := split $content "</p>" }}
    
    {{/* Hero Image (optional) */}}
    {{ $hero := or .Params.hero .Params.og_image }}
    {{ with $hero }}
    <figure class="mb-6 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700 bg-gray-100 dark:bg-gray-800">
      <img src="{{ . }}" alt="{{ $.Title }}" class="w-full h-auto block" loading="eager" />
    </figure>
    {{ end }}

    {{/* Tampilkan 3 paragraf pertama */}}
    {{ range first 3 $paragraphs }}
      {{ . | safeHTML }}{{ if not (strings.HasSuffix . "</p>") }}</p>{{ end }}
    {{ end }}
    
    {{/* AdSense: Mid-Article (setelah 3 paragraf) */}}
    {{ if gt (len $paragraphs) 3 }}
      {{ partial "adsense-in-article.html" . }}
    {{ end }}
    
    {{/* Tampilkan sisa paragraf */}}
    {{ if gt (len $paragraphs) 3 }}
      {{ range after 3 $paragraphs }}
        {{ . | safeHTML }}{{ if not (strings.HasSuffix . "</p>") }}</p>{{ end }}
      {{ end }}
    {{ end }}

    <!-- Related/Read Also (prefer related by tag) -->
    <div class="bg-gray-100 dark:bg-gray-800 p-4 my-8 rounded">
      <h2 class="text-lg font-semibold mb-2">ðŸ“Œ {{ i18n "read_also" }}</h2>
      {{ $current := . }}
      {{ $firstTag := index .Params.tags 0 }}
      {{ $related := where (where .Site.RegularPages "Type" "blog") "Permalink" "ne" .Permalink }}
      {{ if $firstTag }}
        {{ $related = where $related "Params.tags" "intersect" (slice $firstTag) }}
      {{ end }}
      {{ if lt (len $related) 1 }}
        {{ $related = where (where .Site.RegularPages "Type" "blog") "Permalink" "ne" .Permalink }}
      {{ end }}
      <ul class="list-disc list-inside">
        {{ range first 3 $related }}
        <li>
          <a href="{{ .RelPermalink }}" class="text-blue-600 dark:text-blue-400 hover:underline">{{ .Title }}</a>
        </li>
        {{ end }}
      </ul>
    </div>

    {{/* AdSense: Responsive unit after related block (desktop only) */}}
    <div class="hidden lg:block">
      {{ partial "adsense-unit.html" . }}
    </div>

    {{/* AdSense: Mobile-only banner under article */}}
    {{ partial "adsense-mobile-banner.html" . }}
  </article>

  <!-- ==== RIGHT: SIDEBAR ==== -->
  <aside class="space-y-10">
    <!-- POPULAR POST -->
    <div>
      <h3 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">{{ i18n "popular_post" }}</h3>
      <ul
        class="space-y-3 list-disc list-outside pl-5 text-sm text-gray-800 dark:text-gray-200"
      >
        {{ range first 5 (where .Site.RegularPages "Type" "blog") }}
        <li>
          <a href="{{ .RelPermalink }}" class="hover:text-[#0f7ea9] transition"
            >{{ .Title }}</a
          >
        </li>
        {{ end }}
      </ul>
    </div>

    <!-- Ads: Sidebar (desktop only) -->
    <div class="hidden lg:block mt-8">
      {{ partial "adsense-sidebar-300x250.html" . }}
    </div>
  </aside>
</div>
{{ if not .Params.disable_comments }}
{{ partial "comments.html" . }}
{{ end }}

{{/* Floating Share Button for Mobile */}}
{{ partial "social-share-compact.html" . }}

{{ end }}
