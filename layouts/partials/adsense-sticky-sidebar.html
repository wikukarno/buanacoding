<!-- Ad: Sticky Sidebar (Desktop Only) -->
<div class="hidden lg:block">
  <div id="stickySidebarAd" class="sticky top-8 transition-all duration-300">
    {{ $forceLive := or .Site.Params.ads.forceLive false }}
    {{ if and hugo.IsServer (not $forceLive) }}
    <div class="border border-dashed border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-center text-xs w-[300px] h-[250px] flex flex-col items-center justify-center rounded-lg mx-auto text-gray-500 dark:text-gray-400">
      <div class="text-lg mb-2">ðŸ“Œ</div>
      <div>Sticky Sidebar Ad</div>
      <div class="text-xs opacity-70">300Ã—250 (always visible)</div>
    </div>
    {{ else }}
    <!-- Label Iklan -->
    <div class="text-center mb-3">
      <span class="text-xs text-gray-400 dark:text-gray-500 uppercase tracking-wide font-medium">{{ i18n "advertisement" }}</span>
    </div>
    <!-- Enhanced Sticky Sidebar Ad Unit -->
    {{ $adClient := or .Params.ad_client "ca-pub-3149036684216973" }}
    {{ $adSlot := or .Params.ad_slot_sticky_sidebar "3879195288" }}
    {{ $adChannel := .Params.ad_channel }}
    <div class="bg-white dark:bg-gray-900 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-all duration-300 mx-auto w-[300px] min-h-[250px] overflow-hidden sticky-ad-container">
      <!-- Close button (optional) -->
      <button id="closeStickyAd" class="absolute top-2 right-2 w-6 h-6 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-600 text-xs transition-colors z-10 hidden">
        Ã—
      </button>
      <ins class="adsbygoogle sticky-ad-unit"
           style="display:block; background-color:inherit; min-height:250px;"
           data-ad-client="{{ $adClient }}"
           data-ad-slot="{{ $adSlot }}"
           data-ad-format="auto"
           data-full-width-responsive="true"{{ with $adChannel }} data-ad-channel="{{ . }}"{{ end }}></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>
    {{ end }}
  </div>
</div>

<style>
.sticky-ad-container {
  position: relative;
}

.sticky-ad-container:hover #closeStickyAd {
  display: block;
}

/* Smooth sticky behavior */
#stickySidebarAd {
  will-change: transform;
}

/* Prevent sticky ad from going too low */
@media (min-width: 1024px) {
  #stickySidebarAd {
    max-height: calc(100vh - 120px);
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const stickyAd = document.getElementById('stickySidebarAd');
  const closeButton = document.getElementById('closeStickyAd');
  
  if (closeButton) {
    closeButton.addEventListener('click', function() {
      if (stickyAd) {
        stickyAd.style.display = 'none';
        // Remember user preference
        localStorage.setItem('stickySidebarHidden', 'true');
      }
    });
  }
  
  // Check if user previously closed sticky ad
  if (localStorage.getItem('stickySidebarHidden') === 'true') {
    if (stickyAd) stickyAd.style.display = 'none';
  }
  
  // Enhanced sticky behavior with intersection observer
  if (stickyAd && window.IntersectionObserver) {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.style.opacity = '1';
          entry.target.style.transform = 'translateY(0)';
        }
      });
    }, {
      threshold: 0.1
    });
    
    observer.observe(stickyAd);
  }
});
</script>