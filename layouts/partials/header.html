<header class="bg-[#0f7ea9] dark:bg-[#094d66] text-white shadow">
  <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
    <h1 class="text-2xl font-extrabold tracking-wide">
      <a href="{{ "/" | relLangURL }}" class="hover:opacity-90">BUANACODING</a>
    </h1>

    <!-- DESKTOP NAV -->
    <nav
      class="hidden md:flex items-center space-x-6 font-semibold uppercase tracking-wide"
    >
      {{/* Prefer an explicit allowlist from params.navTags; fallback to top tags */}}
      {{ $navTags := .Site.Params.navTags }}
      {{ if $navTags }}
        {{ range $tag := $navTags }}
          {{ $key := lower $tag }}
          <a
            href="{{ (printf "/tags/%s" ($key | urlize)) | relLangURL }}"
            class="no-underline hover:text-cyan-300 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize"
          >
            {{ $tag }}
          </a>
        {{ end }}
      {{ else }}
        {{/* Show up to 6 tags that have at least 2 posts */}}
        {{ $.Scratch.Set "shown" 0 }}
        {{ range $name, $taxonomy := .Site.Taxonomies.tags }}
          {{ if and (ge (len $taxonomy) 2) (lt ($.Scratch.Get "shown") 6) }}
            <a
              href="{{ (printf "/tags/%s" ($name | urlize)) | relLangURL }}"
              class="no-underline hover:text-cyan-300 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize"
            >
              {{ $name }}
            </a>
            {{ $.Scratch.Add "shown" 1 }}
          {{ end }}
        {{ end }}
      {{ end }}

      <!-- Language Switcher (Desktop as Button Group) -->
      <div class="hidden md:flex items-center">
        {{ $root := . }}
        {{ $homeAlts := $root.Site.Home.AllTranslations }}
        <div class="flex border border-white/30 rounded overflow-hidden text-xs font-medium">
          {{ range $lang := $root.Site.Languages }}
            {{ $isCur := eq $lang.Lang $root.Site.Language.Lang }}
            {{ $url := "" }}
            {{ $has := false }}
            {{ if $isCur }}
              {{ $url = $root.RelPermalink }}
              {{ $has = true }}
            {{ else if $root.IsTranslated }}
              {{ $match := where $root.AllTranslations "Lang" $lang.Lang }}
              {{ with index $match 0 }}
                {{ $url = .RelPermalink }}
                {{ $has = true }}
              {{ end }}
            {{ end }}
            {{ if eq $url "" }}
              {{ $home := where $homeAlts "Lang" $lang.Lang }}
              {{ with index $home 0 }}
                {{ $url = .RelPermalink }}
              {{ end }}
            {{ end }}
            <a href="{{ $url }}"
               data-lang="{{ $lang.Lang }}" data-has-trans="{{ $has }}"
               class="js-lang-link px-2 py-1 {{ if $isCur }}bg-white/20 text-white{{ else }}bg-transparent hover:bg-white/10 text-white/80{{ end }}">
              {{ upper $lang.Lang }}
            </a>
          {{ end }}
        </div>
      </div>

      <!-- 🔍 Search Icon Button (dipindah ke dalam nav) -->
      <button
        id="openSearchModal"
        class="text-white transition duration-300 cursor-pointer focus:outline-none dark:hover:text-[#0f7ea9] hover:text-cyan-300"
        aria-label="Search"
      >
        <i data-feather="search" class="w-5 h-5"></i>
      </button>

      <!-- Theme Toggle -->
      <button
        id="theme-toggle"
        class="ml-2 text-white hover:text-yellow-300 transition duration-300 focus:outline-none cursor-pointer"
        aria-label="Toggle Dark Mode"
      >
        <!-- Sun/Moon Icons -->
        <i id="icon-sun" data-feather="sun" class="w-5 h-5 hidden"></i>
        <i id="icon-moon" data-feather="moon" class="w-5 h-5"></i>
      </button>
    </nav>

    <!-- Mobile Menu Toggle -->
    <button id="menu-toggle" class="md:hidden text-2xl focus:outline-none">
      ☰
    </button>
  </div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="hidden md:hidden px-4 pb-4 space-y-2">
    {{ $navTags := .Site.Params.navTags }}
    {{ if $navTags }}
      {{ range $tag := $navTags }}
        {{ $key := lower $tag }}
        <a
          href="{{ (printf "/tags/%s" ($key | urlize)) | relLangURL }}"
          class="block no-underline hover:text-cyan-500 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize"
        >
          {{ $tag }}
        </a>
      {{ end }}
    {{ else }}
      {{ $.Scratch.Set "shown" 0 }}
      {{ range $name, $taxonomy := .Site.Taxonomies.tags }}
        {{ if and (ge (len $taxonomy) 2) (lt ($.Scratch.Get "shown") 6) }}
        <a
          href="{{ (printf "/tags/%s" ($name | urlize)) | relLangURL }}"
          class="block no-underline hover:text-cyan-500 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize"
        >
          {{ $name }}
        </a>
        {{ $.Scratch.Add "shown" 1 }}
        {{ end }}
      {{ end }}
    {{ end }}

    <!-- Mobile Menu Actions -->
    <div class="mt-8 space-y-6">
      
      <!-- Search Button -->
      <button
        id="openSearchModalMobile"
        class="w-full text-left text-white hover:text-cyan-300 transition duration-300 flex items-center gap-4 py-2"
        aria-label="Search"
      >
        <i data-feather="search" class="w-5 h-5"></i>
        <span class="text-sm font-medium">Search</span>
      </button>

      <!-- Language Switcher -->
      <div class="flex items-center justify-between py-2">
        <div class="flex items-center gap-4">
          <i data-feather="globe" class="w-5 h-5 text-white/80"></i>
          <span class="text-sm font-medium text-white">Language</span>
        </div>
        <div class="flex text-xs">
          {{ $root := . }}
          {{ $homeAlts := $root.Site.Home.AllTranslations }}
          {{ range $lang := $root.Site.Languages }}
            {{ $isCur := eq $lang.Lang $root.Site.Language.Lang }}
            {{ $url := "" }}
            {{ $has := false }}
            {{ if $isCur }}
              {{ $url = $root.RelPermalink }}
              {{ $has = true }}
            {{ else if $root.IsTranslated }}
              {{ $match := where $root.AllTranslations "Lang" $lang.Lang }}
              {{ with index $match 0 }}
                {{ $url = .RelPermalink }}
                {{ $has = true }}
              {{ end }}
            {{ end }}
            {{ if eq $url "" }}
              {{ $home := where $homeAlts "Lang" $lang.Lang }}
              {{ with index $home 0 }}
                {{ $url = .RelPermalink }}
              {{ end }}
            {{ end }}
            <a href="{{ $url }}"
               data-lang="{{ $lang.Lang }}" data-has-trans="{{ $has }}"
               class="js-lang-link px-3 py-1.5 {{ if $isCur }}text-white font-medium{{ else }}text-white/60 hover:text-white{{ end }}">
              {{ upper $lang.Lang }}
            </a>
          {{ end }}
        </div>
      </div>

      <!-- Theme Toggle -->
      <button
        id="theme-toggle-mobile"
        class="w-full text-left text-white hover:text-cyan-300 transition duration-300 flex items-center gap-4 py-2"
        aria-label="Toggle Dark Mode"
      >
        <i id="icon-sun-mobile" data-feather="sun" class="w-5 h-5 hidden"></i>
        <i id="icon-moon-mobile" data-feather="moon" class="w-5 h-5"></i>
        <span class="text-sm font-medium">Theme</span>
      </button>
      
    </div>
  </div>
</header>

<!-- Header Leaderboard Ad -->
{{ partial "adsense-header-leaderboard.html" . }}

<!-- Search Modal -->
<div
  id="searchModal"
  class="fixed inset-0 z-50 hidden flex justify-center items-center bg-black/30 dark:bg-black/60 backdrop-blur-md p-4"
>
  <div
    class="bg-white dark:bg-[#1f2937] rounded-xl shadow-2xl w-full max-w-xl p-6 relative"
  >
    <!-- Close Button -->
    <button
      id="closeSearchModal"
      class="absolute -top-4 -right-4 bg-white dark:bg-[#374151] rounded-full p-1 shadow hover:bg-gray-100 dark:hover:bg-gray-600 transition duration-200 ease-in-out transform hover:scale-110"
    >
      <i
        data-feather="x"
        class="w-5 h-5 text-gray-600 dark:text-white hover:text-red-500"
      ></i>
    </button>

    <!-- Search Input -->
    <input
      type="text"
      id="searchBox"
      placeholder="{{ i18n "search_placeholder" }}"
      class="w-full px-4 py-3 mb-4 border border-cyan-400 text-gray-800 dark:text-white dark:bg-[#374151] placeholder-gray-400 dark:placeholder-gray-400 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500"
    />

    <!-- Search Results Ad Banner -->
    {{ partial "adsense-search-banner.html" . }}

    <!-- Result List -->
    <ul
      id="results"
      class="bg-white dark:bg-[#1f2937] rounded-lg shadow max-h-60 overflow-y-auto divide-y divide-gray-200 dark:divide-gray-600"
    ></ul>
  </div>
</div>
