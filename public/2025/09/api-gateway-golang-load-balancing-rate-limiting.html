<!doctype html><html lang=en data-theme=light><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>API Gateway with Golang - Load Balancing and Rate Limiting Implementation | Level Up Your Code | Web & App Development Tutorials</title><meta name=description content="Learn how to build a production-ready API Gateway in Go with advanced load balancing algorithms and rate limiting mechanisms. Complete implementation guide with real-world examples and best practices."><meta name=keywords content="golang api gateway,load balancing go,rate limiting golang,microservices gateway,reverse proxy go,api rate limiting,round robin load balancer,golang middleware"><link rel=canonical href=https://www.buanacoding.com/2025/09/api-gateway-golang-load-balancing-rate-limiting.html><link rel=preconnect href=https://cdn.buanacoding.com crossorigin><link rel=preconnect href=https://unpkg.com crossorigin><link rel=preconnect href=https://cdn.jsdelivr.net crossorigin><link rel=preconnect href=https://pagead2.googlesyndication.com crossorigin><link rel=preconnect href=https://www.googletagmanager.com crossorigin><link rel=dns-prefetch href=https://pagead2.googlesyndication.com><link rel=dns-prefetch href=https://www.googletagmanager.com><link rel=alternate hreflang=en href=https://www.buanacoding.com/2025/09/api-gateway-golang-load-balancing-rate-limiting.html><meta property="og:type" content="article"><meta property="article:published_time" content="2025-09-29T07:00:00+07:00"><meta property="article:modified_time" content="2025-09-29T07:00:00+07:00"><meta property="article:author" content="Wiku Karno"><meta property="article:section" content="Go"><meta property="article:tag" content="Go"><meta property="article:tag" content="API Gateway"><meta property="article:tag" content="Load Balancing"><meta property="article:tag" content="Rate Limiting"><meta property="article:tag" content="Microservices"><meta property="article:tag" content="Performance"><meta property="og:site_name" content="Level Up Your Code | Web & App Development Tutorials"><meta property="og:title" content="API Gateway with Golang - Load Balancing and Rate Limiting Implementation | Level Up Your Code | Web & App Development Tutorials"><meta property="og:description" content="Learn how to build a production-ready API Gateway in Go with advanced load balancing algorithms and rate limiting mechanisms. Complete implementation guide with real-world examples and best practices."><meta property="og:url" content="https://www.buanacoding.com/2025/09/api-gateway-golang-load-balancing-rate-limiting.html"><meta property="og:image" content="https://www.buanacoding.com/og-image.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="API Gateway with Golang - Load Balancing and Rate Limiting Implementation | Level Up Your Code | Web & App Development Tutorials"><meta name=twitter:description content="Learn how to build a production-ready API Gateway in Go with advanced load balancing algorithms and rate limiting mechanisms. Complete implementation guide with real-world examples and best practices."><meta name=twitter:image content="https://www.buanacoding.com/og-image.jpg"><script type=application/ld+json>
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "API Gateway with Golang - Load Balancing and Rate Limiting Implementation | Level Up Your Code | Web \u0026 App Development Tutorials",
    "description": "Learn how to build a production-ready API Gateway in Go with advanced load balancing algorithms and rate limiting mechanisms. Complete implementation guide with real-world examples and best practices.",
    "inLanguage": "en",
    "datePublished": "2025-09-29T07:00:00\u002b07:00",
    "dateModified": "2025-09-29T07:00:00\u002b07:00",
    "author": {
      "@type": "Person",
      "name": "Wiku Karno"
    },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/www.buanacoding.com\/2025\/09\/api-gateway-golang-load-balancing-rate-limiting.html"
    },
    "image": {
      "@type": "ImageObject",
      "url": "https:\/\/www.buanacoding.com\/og-image.jpg",
      "width": 1200,
      "height": 630
    },
    "publisher": {
      "@type": "Organization",
      "name": "Level Up Your Code | Web \u0026 App Development Tutorials",
      "logo": {
        "@type": "ImageObject",
        "url": "https:\/\/www.buanacoding.com\/og-image.jpg",
        "width": 600,
        "height": 60
      }
    }
  }
  </script><script type=application/ld+json>
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "https:\/\/www.buanacoding.com\/"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "Go",
        "item": "https:\/\/www.buanacoding.com\/tags/go/"
      },
      {
        "@type": "ListItem",
        "position": 3,
        "name": "API Gateway with Golang - Load Balancing and Rate Limiting Implementation"
      }
    ]
  }
  </script><link rel=icon href=/favicon.ico type=image/x-icon><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel=stylesheet><link rel=stylesheet href="/style.css?v=1768802750"><link rel=stylesheet href="/css/overrides.css?v=1768802750" media=print onload='this.media="all"'><link rel=stylesheet href="/css/syntax.css?v=1768802750" media=print onload='this.media="all"'><noscript><link rel=stylesheet href="/css/overrides.css?v=1768802750"><link rel=stylesheet href="/css/syntax.css?v=1768802750"></noscript><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("consent","default",{ad_storage:"granted",ad_user_data:"granted",ad_personalization:"granted",analytics_storage:"granted"})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-0EN9J73FXF"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0EN9J73FXF")</script><script async src="https://fundingchoicesmessages.google.com/i/pub-3149036684216973?ers=1"></script><script>(function(){function e(){if(!window.frames.googlefcPresent)if(document.body){const e=document.createElement("iframe");e.style="width: 0; height: 0; border: none; z-index: -1000; left: -1000px; top: -1000px;",e.style.display="none",e.name="googlefcPresent",document.body.appendChild(e)}else setTimeout(e,0)}e()})()</script><script>(function(){"use strict";function at(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}Z=typeof Object.defineProperties=="function"?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype?e:(e[t]=n.value,e)};function Ge(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var t,n=0;n<e.length;++n)if(t=e[n],t&&t.Math==Math)return t;throw Error("Cannot find global object")}Pe=Ge(this);function c(e,t){if(t)a:{var n,o,s=Pe;e=e.split(".");for(n=0;n<e.length-1;n++){if(o=e[n],!(o in s))break a;s=s[o]}e=e[e.length-1],n=s[e],t=t(n),t!=n&&t!=null&&Z(s,e,{configurable:!0,writable:!0,value:t})}}function G(e){return e.raw=e}function b(e){var t=typeof Symbol!="undefined"&&Symbol.iterator&&e[Symbol.iterator];if(t)return t.call(e);if(typeof e.length=="number")return{next:at(e)};throw Error(String(e)+" is not an iterable or ArrayLike")}function Xe(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}if(Se=typeof Object.create=="function"?Object.create:function(e){function t(){}return t.prototype=e,new t},typeof Object.setPrototypeOf=="function")R=Object.setPrototypeOf;else{a:{we={a:!0},V={};try{V.__proto__=we,P=V.a;break a}catch{}P=!1}R=P?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}W=R;function K(e,t){if(e.prototype=Se(t.prototype),e.prototype.constructor=e,W)W(e,t);else for(n in t)if(n!="prototype")if(Object.defineProperties){var n,s=Object.getOwnPropertyDescriptor(t,n);s&&Object.defineProperty(e,n,s)}else e[n]=t[n];e.A=t.prototype}function Q(){for(var t=Number(this),n=[],e=t;e<arguments.length;e++)n[e-t]=arguments[e];return n}c("Object.is",function(e){return e||function(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}}),c("Array.prototype.includes",function(e){return e||function(e,t){var s,o,n=this;n instanceof String&&(n=String(n)),s=n.length,t=t||0;for(t<0&&(t=Math.max(t+s,0));t<s;t++)if(o=n[t],o===e||Object.is(o,e))return!0;return!1}}),c("String.prototype.includes",function(e){return e||function(e,t){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(e,t||0)!==-1}}),c("Number.MAX_SAFE_INTEGER",function(){return 9007199254740991}),c("Number.isFinite",function(e){return e||function(e){return typeof e=="number"&&!isNaN(e)&&e!==1/0&&e!==-(1/0)}}),c("Number.isInteger",function(e){return e||function(e){return!!Number.isFinite(e)&&e===Math.floor(e)}}),c("Number.isSafeInteger",function(e){return e||function(e){return Number.isInteger(e)&&(e<0?-e:e)<=Number.MAX_SAFE_INTEGER}}),c("Math.trunc",function(e){return e||function(e){if(e=Number(e),isNaN(e)||e===1/0||e===-(1/0)||e===0)return e;var t=Math.floor(e<0?-e:e);return e<0?-t:t}}),e=this||self;function _(t,n){a:{for(var s=["CLOSURE_FLAGS"],o=e,i=0;i<s.length;i++)if(o=o[s[i]],o==null){s=null;break a}s=o}return t=s&&s[t],t??n}function q(e){return e}function ct(t){e.setTimeout(function(){throw t},0)}var ae=_(610401301,!1),ot=_(188588736,!0),et=_(645172343,_(1,!0)),Oe=e.navigator,O=Oe?Oe.userAgentData||null:null;function L(e){return!!ae&&!!O&&O.brands.some(function(t){return(t=t.brand)&&t.indexOf(e)!=-1})}function s(t){var n;a:{if((n=e.navigator)&&(n=n.userAgent))break a;n=""}return n.indexOf(t)!=-1}function r(){return!!ae&&!!O&&O.brands.length>0}function F(){return r()?L("Chromium"):(s("Chrome")||s("CriOS"))&&!(r()?0:s("Edge"))||s("Silk")}be=!r()&&(s("Trident")||s("MSIE")),!s("Android")||F(),F(),s("Safari")&&(F()||(r()?0:s("Coast"))||(r()?0:s("Opera"))||(r()?0:s("Edge"))||(r()?L("Microsoft Edge"):s("Edg/"))||r()&&L("Opera")),M={},v=null,T=typeof Uint8Array!="undefined",He=!be&&typeof btoa=="function";function N(){return typeof BigInt=="function"}g=typeof Symbol=="function"&&typeof Symbol()=="symbol";function xe(e){return typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():e}var Z,Pe,Se,t,R,P,we,e,n,O,V,W,be,v,M,T,He,Te,m,g,X,oe,C,E,Ae,j,Fe,le,re,ie,x=xe(),H=xe("2ex"),ye=g?function(e,t){e[x]|=t}:function(e,t){e.g!==0[0]?e.g|=t:Object.defineProperties(e,{g:{value:t,configurable:!0,writable:!0,enumerable:!1}})},h=g?function(e){return e[x]|0}:function(e){return e.g|0},d=g?function(e){return e[x]}:function(e){return e.g},l=g?function(e,t){e[x]=t}:function(e,t){e.g!==0[0]?e.g=t:Object.defineProperties(e,{g:{value:t,configurable:!0,writable:!0,enumerable:!1}})};function it(e,t){l(t,(e|0)&-14591)}function U(e,t){l(t,(e|34)&-14557)}m={},X={};function Ie(e){return!(!e||typeof e!="object"||e.g!==X)}function S(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)&&e.constructor===Object}function y(e,t,n){if(!Array.isArray(e)||e.length)return!1;var s=h(e);return!!(s&1)||!!(t&&(Array.isArray(t)?t.includes(n):t.has(n)))&&(l(e,s|1),!0)}t=0,n=0;function J(e){var s=e>>>0;t=s,n=(e-s)/4294967296>>>0}function ee(e){if(e<0){J(-e);var s=b(A(t,n));e=s.next().value,s=s.next().value,t=e>>>0,n=s>>>0}else J(e)}function te(e,t){if(t>>>=0,e>>>=0,t<=2097151)var n=""+(4294967296*t+e);else N()?n=""+(BigInt(t)<<BigInt(32)|BigInt(e)):(n=(e>>>24|t<<8)&16777215,t=t>>16&65535,e=(e&16777215)+n*6777216+t*6710656,n+=t*8147497,t*=2,e>=1e7&&(n+=e/1e7>>>0,e%=1e7),n>=1e7&&(t+=n/1e7>>>0,n%=1e7),n=t+ne(n)+ne(e));return n}function ne(e){return e=String(e),"0000000".slice(e.length)+e}function A(e,t){return t=~t,e?e=~e+1:t+=1,[e,t]}oe=/^-?([1-9][0-9]*|0)(\.[0-9]+)?$/;function $(e,t){return E=t,e=new e(t),E=0[0],e}function k(e,t,n){if(e==null&&(e=E),E=0[0],e==null){var o,i,s=96;n?(e=[n],s|=512):e=[],t&&(s=s&-16760833|(t&1023)<<14)}else{if(!Array.isArray(e))throw Error("narr");if(s=h(e),s&2048)throw Error("farr");if(s&64)return e;if(s|=64,n&&(s|=512,n!==e[0]))throw Error("mid");a:{if(n=e,o=n.length,o&&(i=o-1,S(n[i]))){if(s|=256,t=i-(+!!(s&512)-1),t>=1024)throw Error("pvtlmt");s=s&-16760833|(t&1023)<<14;break a}if(t){if(t=Math.max(t,o-(+!!(s&512)-1)),t>1024)throw Error("spvt");s=s&-16760833|(t&1023)<<14}}}return l(e,s),e}function st(e){switch(typeof e){case"number":return isFinite(e)?e:String(e);case"boolean":return e?1:0;case"object":if(e)if(Array.isArray(e)){if(y(e,0[0],0))return}else if(T&&e!=null&&e instanceof Uint8Array){if(He){for(var n,o,i,a,c,l,t="",s=0,r=e.length-10240;s<r;)t+=String.fromCharCode.apply(null,e.subarray(s,s+=10240));t+=String.fromCharCode.apply(null,s?e.subarray(s):e),e=btoa(t)}else{if(t===0[0]&&(t=0),!v){v={},s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),r=["+/=","+/","-_=","-_.","-_"];for(a=0;a<5;a++){n=s.concat(r[a].split("")),M[a]=n;for(o=0;o<n.length;o++)i=n[o],v[i]===0[0]&&(v[i]=o)}}t=M[t],s=Array(Math.floor(e.length/3)),r=t[64]||"";for(a=n=0;n<e.length-2;n+=3)c=e[n],l=e[n+1],i=e[n+2],o=t[c>>2],c=t[(c&3)<<4|l>>4],l=t[(l&15)<<2|i>>6],i=t[i&63],s[a++]=o+c+l+i;switch(o=0,i=r,e.length-n){case 2:o=e[n+1],i=t[(o&15)<<2]||r;case 1:e=e[n],s[a]=t[e>>2]+t[(e&3)<<4|o>>4]+i+r}e=s.join("")}return e}}return e}function nt(e,t,n){e=Array.prototype.slice.call(e);var i,o=e.length,s=t&256?e[o-1]:0[0];o+=s?-1:0;for(t=t&512?1:0;t<o;t++)e[t]=n(e[t]);if(s){t=e[t]={};for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=n(s[i]))}return e}function de(e,t,n,s,o){if(e!=null){if(Array.isArray(e))e=y(e,0[0],0)?0[0]:o&&h(e)&2?e:B(e,t,n,s!==0[0],o);else if(S(e)){var i,a={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&(a[i]=de(e[i],t,n,s,o));e=a}else e=t(e,s);return e}}function B(e,t,n,s,o){var i,a=s||n?h(e):0;s=s?!!(a&32):0[0],e=Array.prototype.slice.call(e);for(i=0;i<e.length;i++)e[i]=de(e[i],t,n,s,o);return n&&n(a,e),e}function We(e){return e.s===m?e.toJSON():st(e)}function me(e,t,n){if(n=n===0[0]?U:n,e!=null){if(T&&e instanceof Uint8Array)return t?e:new Uint8Array(e);if(Array.isArray(e)){var s=h(e);return s&2?e:(t&&(t=s===0||!!(s&32)&&!(s&64||!(s&16))),t?(l(e,(s|34)&-12293),e):B(e,me,s&4?U:n,!0,!0))}return e.s===m&&(n=e.h,s=d(n),e=s&2?e:$(e.constructor,fe(n,s,!0))),e}}function fe(e,t,n){var s=n||t&2?U:it,o=!!(t&32);return e=nt(e,t,function(e){return me(e,o,s)}),ye(e,32|(n?2:0)),e}function pe(e,t){return e=e.h,ve(e,d(e),t)}function ge(e,t,n,s){if(t=s+(+!!(t&512)-1),!(t<0||t>=e.length||t>=n))return e[t]}function ve(e,t,n,s){if(n===-1)return null;var o,a,i=t>>14&1023||536870912;if(n>=i){if(t&256)return e[e.length-1][n]}else return a=e.length,s&&t&256&&(s=e[a-1][n],s!=null)?(ge(e,t,i,n)&&H!=null&&(e=(o=Te)!=null?o:Te={},o=e[H]||0,o>=4||(e[H]=o+1,o=Error(),o.__closure__error__context__984382||(o.__closure__error__context__984382={}),o.__closure__error__context__984382.severity="incident",ct(o))),s):ge(e,t,i,n)}function Y(e,t,n,s,o){var i,a=t>>14&1023||536870912;if(n>=a||o&&!et){if(i=t,t&256)o=e[e.length-1];else{if(s==null)return;o=e[a+(+!!(t&512)-1)]={},i|=256}o[n]=s,n<a&&(e[n+(+!!(t&512)-1)]=0[0]),i!==t&&l(e,i)}else e[n+(+!!(t&512)-1)]=s,t&256&&(e=e[e.length-1],n in e&&delete e[n])}function je(e,t){var a,r,s=he,c=c!==0[0]&&c,o=e.h,i=d(o),n=ve(o,i,t,c);return n!=null&&typeof n=="object"&&n.s===m?s=n:Array.isArray(n)?(a=h(n),r=a,r===0&&(r|=i&32),r|=i&2,r!==a&&l(n,r),s=new s(n)):s=0[0],s!==n&&s!=null&&Y(o,i,t,s,c),o=s,o==null?o:(e=e.h,i=d(e),i&2||(n=o,s=n.h,a=d(s),n=a&2?$(n.constructor,fe(s,a,!1)):n,n!==o&&(o=n,Y(e,i,t,o,c))),o)}function I(e,t){return e=pe(e,t),e==null||typeof e=="string"?e:0[0]}function _e(e,s){if(i=i===0[0]?0:i,e=pe(e,s),e!=null)if(s=typeof e,s==="number"?Number.isFinite(e):s!=="string"?0:oe.test(e)){if(typeof e=="number")e=e|0,!Number.isSafeInteger(e)&&(ee(e),s=t,o=n,(e=o&2147483648)&&(s=~s+1>>>0,o=~o>>>0,s==0&&(o=o+1>>>0)),s=o*4294967296+(s>>>0),e=e?-s:s);else if(s=Number(e)|0,Number.isSafeInteger(s))e=String(s);else if(s=e.indexOf("."),s!==-1&&(e=e.substring(0,s)),!(e[0]==="-"?e.length<20||e.length===20&&Number(e.substring(0,7))>-922337:e.length<19||e.length===19&&Number(e.substring(0,6))<922337)){if(e.length<16)ee(Number(e));else if(N())e=BigInt(e),t=Number(e&BigInt(4294967295))>>>0,n=Number(e>>BigInt(32)&BigInt(4294967295));else{s=+(e[0]==="-"),n=t=0,o=e.length;for(var o,i,a=s,r=(o-s)%6+s;r<=o;a=r,r+=6)a=Number(e.slice(a,r)),n*=1e6,t=t*1e6+a,t>=4294967296&&(n+=t/4294967296|0,n>>>=0,t>>>=0);s&&(s=b(A(t,n)),e=s.next().value,s=s.next().value,t=e,n=s)}e=t,s=n,s&2147483648?N()?e=""+(BigInt(s|0)<<BigInt(32)|BigInt(e>>>0)):(s=b(A(e,s)),e=s.next().value,s=s.next().value,e="-"+te(e,s)):e=te(e,s)}}else e=0[0];return e??i}function a(e,t){var n=n===0[0]?"":n;return e=I(e,t),e??n}function u(e,t,n){this.h=k(e,t,n)}u.prototype.toJSON=function(){return Ce(this)},u.prototype.s=m,u.prototype.toString=function(){try{return C=!0,Ce(this).toString()}finally{C=!1}};function Ce(e){if(a=C?e.h:B(e.h,We,0[0],0[0],!1),m=!C,h=ot?0[0]:e.constructor.v,l=d(m?e.h:a),e=a.length){var t,n,s,o,i,a,l,u,h,m,f,c=a[e-1],r=S(c);if(r?e--:c=0[0],l=+!!(l&512)-1,i=a,r){b:{if(s=c,n={},r=!1,s)for(t in s)Object.prototype.hasOwnProperty.call(s,t)&&(isNaN(+t)?n[t]=s[t]:(o=s[t],Array.isArray(o)&&(y(o,h,+t)||Ie(o)&&o.size===0)&&(o=null),o==null&&(r=!0),o!=null&&(n[t]=o)));if(r){for(u in n)break b;n=null}else n=s}s=n==null?c!=null:n!==c}for(;e>0;e--){if(u=e-1,t=i[u],u-=l,!(t==null||y(t,h,u)||Ie(t)&&t.size===0))break;f=!0}(i!==a||s||f)&&(m?(f||s||n)&&(i.length=e):i=Array.prototype.slice.call(i,0,e),n&&i.push(n)),a=i}return a}function Ee(e){return function(t){if(t==null||t=="")t=new e;else{if(t=JSON.parse(t),!Array.isArray(t))throw Error("dnarr");ye(t,32),t=$(e,t)}return t}}function ke(e){this.h=k(e)}K(ke,u),Ae=Ee(ke);function w(e){this.g=e}w.prototype.toString=function(){return this.g+""},Fe={};function D(t){if(j===0[0]){var n=null,s=e.trustedTypes;if(s&&s.createPolicy){try{n=s.createPolicy("goog#html",{createHTML:q,createScript:q,createScriptURL:q})}catch(t){e.console&&e.console.error(t.message)}j=n}else j=n}return t=(n=j)?n.createScriptURL(t):t,new w(t,Fe)}function ze(e){if(t=Q.apply(1,arguments),t.length===0)return D(e[0]);for(var t,s=e[0],n=0;n<t.length;n++)s+=encodeURIComponent(t[n])+e[n+1];return D(s)}function Ye(e,t){e.src=t instanceof w&&t.constructor===w?t.g:"type_error:TrustedResourceUrl";var n,s;(n=(t=(s=(n=(e.ownerDocument&&e.ownerDocument.defaultView||window).document).querySelector)==null?0[0]:s.call(n,"script[nonce]"))?t.nonce||t.getAttribute("nonce")||"":"")&&e.setAttribute("nonce",n)}function Ne(){return Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)}function Le(e,t){return t=String(t),e.contentType==="application/xhtml+xml"&&(t=t.toLowerCase()),e.createElement(t)}function Re(t){this.g=t||e.document||document}function qe(e){return e=e===0[0]?document:e,e.createElement("script")}function z(e,t,n,s,o,i){try{var r=e.g,a=qe(r);a.async=!0,Ye(a,t),r.head.appendChild(a),a.addEventListener("load",function(){o(),s&&r.head.removeChild(a)}),a.addEventListener("error",function(){n>0?z(e,t,n-1,s,o,i):(s&&r.head.removeChild(a),i())})}catch{i()}}var Ke=e.atob("aHR0cHM6Ly93d3cuZ3N0YXRpYy5jb20vaW1hZ2VzL2ljb25zL21hdGVyaWFsL3N5c3RlbS8xeC93YXJuaW5nX2FtYmVyXzI0ZHAucG5n"),Ue=e.atob("WW91IGFyZSBzZWVpbmcgdGhpcyBtZXNzYWdlIGJlY2F1c2UgYWQgb3Igc2NyaXB0IGJsb2NraW5nIHNvZnR3YXJlIGlzIGludGVyZmVyaW5nIHdpdGggdGhpcyBwYWdlLg=="),Je=e.atob("RGlzYWJsZSBhbnkgYWQgb3Igc2NyaXB0IGJsb2NraW5nIHNvZnR3YXJlLCB0aGVuIHJlbG9hZCB0aGlzIHBhZ2Uu");function tt(e,t,n){this.i=e,this.u=t,this.o=n,this.g=null,this.j=[],this.m=!1,this.l=new Re(this.i)}function Ve(t){if(t.i.body&&!t.m){var n=function(){Be(t),e.setTimeout(function(){Me(t,3)},50)};z(t.l,t.u,2,!0,function(){e[t.o]||n()},n),t.m=!0}}function Be(e){for(var s,a,r,c,t=o(1,5),n=0;n<t;n++)s=i(e),e.i.body.appendChild(s),e.j.push(s);t=i(e),t.style.bottom="0",t.style.left="0",t.style.position="fixed",t.style.width=o(100,110).toString()+"%",t.style.zIndex=o(2147483544,2147483644).toString(),t.style.backgroundColor=De(249,259,242,252,219,229),t.style.boxShadow="0 0 12px #888",t.style.color=De(0,10,0,10,0,10),t.style.display="flex",t.style.justifyContent="center",t.style.fontFamily="Roboto, Arial",n=i(e),n.style.width=o(80,85).toString()+"%",n.style.maxWidth=o(750,775).toString()+"px",n.style.margin="24px",n.style.display="flex",n.style.alignItems="flex-start",n.style.justifyContent="center",s=Le(e.l.g,"IMG"),s.className=Ne(),s.src=Ke,s.alt="Warning icon",s.style.height="24px",s.style.width="24px",s.style.paddingRight="16px",a=i(e),r=i(e),r.style.fontWeight="bold",r.textContent=Ue,c=i(e),c.textContent=Je,p(e,a,r),p(e,a,c),p(e,n,s),p(e,n,a),p(e,t,n),e.g=t,e.i.body.appendChild(e.g),t=o(1,5);for(n=0;n<t;n++)s=i(e),e.i.body.appendChild(s),e.j.push(s)}function p(e,t,n){for(var r,s=o(1,5),a=0;a<s;a++)r=i(e),t.appendChild(r);t.appendChild(n),n=o(1,5);for(s=0;s<n;s++)a=i(e),t.appendChild(a)}function o(e,t){return Math.floor(e+Math.random()*(t-e))}function De(e,t,n,s,i,a){return"rgb("+o(Math.max(e,0),Math.min(t,255)).toString()+","+o(Math.max(n,0),Math.min(s,255)).toString()+","+o(Math.max(i,0),Math.min(a,255)).toString()+")"}function i(e){return e=Le(e.l.g,"DIV"),e.className=Ne(),e}function Me(t,n){n<=0||t.g!=null&&t.g.offsetHeight!==0&&t.g.offsetWidth!==0||(Qe(t),Be(t),e.setTimeout(function(){Me(t,n-1)},50))}function Qe(e){for(var n=b(e.j),t=n.next();!t.done;t=n.next())(t=t.value)&&t.parentNode&&t.parentNode.removeChild(t);e.j=[],(n=e.g)&&n.parentNode&&n.parentNode.removeChild(n),e.g=null}function Ze(t,n,s,o,i){function r(t){document.body?c(document.body):t>0?e.setTimeout(function(){r(t-1)},i):n()}function c(s){s.appendChild(a),e.setTimeout(function(){a?(a.offsetHeight!==0&&a.offsetWidth!==0?n():t(),a.parentNode&&a.parentNode.removeChild(a)):t()},o)}var a=$e(s);r(3)}function $e(e){var t=document.createElement("div");return t.className=e,t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.left="-10000px",t.style.top="-10000px",t.style.zIndex="-10000",t}function he(e){this.h=k(e)}K(he,u);function ue(e){this.h=k(e)}K(ue,u),le=Ee(ue);function ce(e){if(!e)return null;e=I(e,4);var t;return e==null?t=null:t=D(e),t}re=G([""]),ie=G([""]);function se(e,t){this.m=e,this.o=new Re(e.document),this.g=t,this.j=a(this.g,1),this.u=ce(je(this.g,2))||ze(re),this.i=!1,t=ce(je(this.g,13))||ze(ie),this.l=new tt(e.document,t,a(this.g,12))}se.prototype.start=function(){rt(this)};function rt(t){lt(t),z(t.o,t.u,3,!1,function(){a:{var o,n=t.j,s=e.btoa(n);if(s=e[s]){try{o=Ae(e.atob(s))}catch{n=!1;break a}n=n===I(o,1)}else n=!1}n?f(t,a(t.g,14)):(f(t,a(t.g,8)),Ve(t.l))},function(){Ze(function(){f(t,a(t.g,7)),Ve(t.l)},function(){return f(t,a(t.g,6))},a(t.g,9),_e(t.g,10),_e(t.g,11))})}function f(e,t){e.i||(e.i=!0,e=new e.m.XMLHttpRequest,e.open("GET",t,!0),e.send())}function lt(t){var n=e.btoa(t.j);t.m[n]&&f(t,a(t.g,5))}(function(t,n){e[t]=function(){var s=Q.apply(0,arguments);e[t]=function(){},n.call.apply(n,[null].concat(s instanceof Array?s:Xe(b(s))))}})("__h82AlnkH6D91__",function(e){typeof window.atob=="function"&&new se(window,le(window.atob(e))).start()})}).call(this),window.__h82AlnkH6D91__("WyJwdWItMzE0OTAzNjY4NDIxNjk3MyIsW251bGwsbnVsbCxudWxsLCJodHRwczovL2Z1bmRpbmdjaG9pY2VzbWVzc2FnZXMuZ29vZ2xlLmNvbS9iL3B1Yi0zMTQ5MDM2Njg0MjE2OTczIl0sbnVsbCxudWxsLCJodHRwczovL2Z1bmRpbmdjaG9pY2VzbWVzc2FnZXMuZ29vZ2xlLmNvbS9lbC9BR1NLV3hXRW1tb2ZrZGEwZHlSNkcxMkdNSnNEZDF5UFF4a3FSYS11R2NVem9LZHh6NGFxNndzZm5DN3VPekxfWmljWUZvSW5iYnNKRGtFUUU1a1RUNFFGb25MMF9nXHUwMDNkXHUwMDNkP3RlXHUwMDNkVE9LRU5fRVhQT1NFRCIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFZVeXNCQ3NSc2llS3ExOENZVDNibVVqbFREbTVKM01FR1BSdUVoRjFsV3c3UjVNdGRwWnhNM2hJQm1tMnZhbjNmVWxZcVNLSnoycE5xMWNSTUJZYUxfLXdcdTAwM2RcdTAwM2Q/YWJcdTAwM2QxXHUwMDI2c2JmXHUwMDNkMSIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFVvQ2JlQlRkS2gzZmU0NnB1VERhek9PdHN0b0p3NjhKUU5SOGQ1OFgwWm9QRlV0LUZPUm1HU1ZJajM2WXQwQjU3c0t1bUFmcjFNWU5JV3U3U3JXNi1EQkFcdTAwM2RcdTAwM2Q/YWJcdTAwM2QyXHUwMDI2c2JmXHUwMDNkMSIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFdORXhuRXA0STJueGlBNXdiejVRMDZzT0Njek53bFltRXo4cWhOY0sxZzd2N1UwR2ZVZ0hJOFlPeWk1Qms2NGljWTNzU3BMRE9IZ3pSNTg0VlA5ak5sZmdcdTAwM2RcdTAwM2Q/c2JmXHUwMDNkMiIsImRpdi1ncHQtYWQiLDIwLDEwMCwiY0hWaUxUTXhORGt3TXpZMk9EUXlNVFk1TnpNXHUwMDNkIixbbnVsbCxudWxsLG51bGwsImh0dHBzOi8vd3d3LmdzdGF0aWMuY29tLzBlbW4vZi9wL3B1Yi0zMTQ5MDM2Njg0MjE2OTczLmpzP3VzcXBcdTAwM2RDQWMiXSwiaHR0cHM6Ly9mdW5kaW5nY2hvaWNlc21lc3NhZ2VzLmdvb2dsZS5jb20vZWwvQUdTS1d4VmpzRmdxZHhwME1yZFNEMjF6Q2l2TkR3cjZvM0FfNEQyYVlaRUJJZXZNSmN1eUVvNmRmX29XMUNiZFVRdVR1WW52cGZUdWhteS1NTXZfcGlqVlB0NUQxZ1x1MDAzZFx1MDAzZCJd")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3149036684216973" crossorigin=anonymous></script></head><body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen flex flex-col"><header class="bg-[#0f7ea9] dark:bg-[#094d66] text-white shadow"><div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center"><h1 class="text-2xl font-bold tracking-wide"><a href=/ class=hover:opacity-90>BUANACODING</a></h1><nav class="hidden md:flex items-center space-x-6 font-semibold uppercase tracking-wide"><a href=/tags/general class="no-underline hover:text-cyan-300 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize">General
</a><a href=/tags/go class="no-underline hover:text-cyan-300 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize">Golang
</a><a href=/tags/laravel class="no-underline hover:text-cyan-300 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize">Laravel
</a><a href=/tags/linux class="no-underline hover:text-cyan-300 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize">Linux
</a><a href=/tags/python class="no-underline hover:text-cyan-300 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize">Python
</a><a href=/tags/security class="no-underline hover:text-cyan-300 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize">Security</a><div class="hidden md:flex items-center"><div class="flex border border-white/30 rounded overflow-hidden text-xs font-medium"><a href=/2025/09/api-gateway-golang-load-balancing-rate-limiting.html data-lang=en data-has-trans=true class="js-lang-link px-2 py-1 bg-white/20 text-white">EN
</a><a href=/id/ data-lang=id data-has-trans=false class="js-lang-link px-2 py-1 bg-transparent hover:bg-white/10 text-white/80">ID</a></div></div><button id=openSearchModal class="text-white transition duration-300 cursor-pointer focus:outline-none dark:hover:text-[#0f7ea9] hover:text-cyan-300" aria-label=Search>
<i data-feather=search class="w-5 h-5"></i>
</button>
<button id=theme-toggle class="ml-2 text-white hover:text-yellow-300 transition duration-300 focus:outline-none cursor-pointer" aria-label="Toggle Dark Mode">
<i id=icon-sun data-feather=sun class="w-5 h-5 hidden"></i>
<i id=icon-moon data-feather=moon class="w-5 h-5"></i></button></nav><button id=menu-toggle class="md:hidden text-2xl focus:outline-none">
☰</button></div><div id=mobile-menu class="hidden md:hidden px-4 pb-4 space-y-2"><a href=/tags/general class="block no-underline hover:text-cyan-500 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize">General
</a><a href=/tags/go class="block no-underline hover:text-cyan-500 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize">Golang
</a><a href=/tags/laravel class="block no-underline hover:text-cyan-500 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize">Laravel
</a><a href=/tags/linux class="block no-underline hover:text-cyan-500 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize">Linux
</a><a href=/tags/python class="block no-underline hover:text-cyan-500 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize">Python
</a><a href=/tags/security class="block no-underline hover:text-cyan-500 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize">Security</a><div class="mt-8 space-y-6"><button id=openSearchModalMobile class="w-full text-left text-white hover:text-cyan-300 transition duration-300 flex items-center gap-4 py-2" aria-label=Search>
<i data-feather=search class="w-5 h-5"></i>
<span class="text-sm font-medium">Search</span></button><div class="flex items-center justify-between py-2"><div class="flex items-center gap-4"><i data-feather=globe class="w-5 h-5 text-white/80"></i>
<span class="text-sm font-medium text-white">Language</span></div><div class="flex text-xs"><a href=/2025/09/api-gateway-golang-load-balancing-rate-limiting.html data-lang=en data-has-trans=true class="js-lang-link px-3 py-1.5 text-white font-medium">EN
</a><a href=/id/ data-lang=id data-has-trans=false class="js-lang-link px-3 py-1.5 text-white/60 hover:text-white">ID</a></div></div><button id=theme-toggle-mobile class="w-full text-left text-white hover:text-cyan-300 transition duration-300 flex items-center gap-4 py-2" aria-label="Toggle Dark Mode">
<i id=icon-sun-mobile data-feather=sun class="w-5 h-5 hidden"></i>
<i id=icon-moon-mobile data-feather=moon class="w-5 h-5"></i>
<span class="text-sm font-medium">Theme</span></button></div></div></header><div class="bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 py-2"><div class="max-w-7xl mx-auto px-4"><div class="text-center mb-2"><span class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-medium">Advertisement</span></div><div class="flex justify-center"><ins class="adsbygoogle lazy-ad" style=display:block data-ad-client=ca-pub-3149036684216973 data-ad-slot=9616560861 data-ad-format=auto data-full-width-responsive=true></ins></div></div></div><div id=searchModal class="fixed inset-0 z-50 hidden flex justify-center items-center bg-black/30 dark:bg-black/60 backdrop-blur-md p-4"><div class="bg-white dark:bg-[#1f2937] rounded-xl shadow-2xl w-full max-w-xl p-6 relative"><button id=closeSearchModal class="absolute -top-4 -right-4 bg-white dark:bg-[#374151] rounded-full p-1 shadow hover:bg-gray-100 dark:hover:bg-gray-600 transition duration-200 ease-in-out transform hover:scale-110">
<i data-feather=x class="w-5 h-5 text-gray-600 dark:text-white hover:text-red-500"></i>
</button>
<input type=text id=searchBox placeholder="Search articles..." class="w-full px-4 py-3 mb-4 border border-cyan-400 text-gray-800 dark:text-white dark:bg-[#374151] placeholder-gray-400 dark:placeholder-gray-400 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500"><div id=searchAdBanner class="mt-4 mb-8 hidden"><div class="text-center mb-2"><span class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-medium">Advertisement</span></div><ins class="adsbygoogle lazy-ad search-results-ad" style=display:block;min-height:100px;max-width:100% data-ad-client=ca-pub-3149036684216973 data-ad-slot=3879195288 data-ad-format=auto data-full-width-responsive=true></ins></div><style>#searchAdBanner{transition:opacity .3s ease-in-out,transform .3s ease-in-out}#searchAdBanner.show{display:block!important;opacity:1;transform:translateY(0)}#searchAdBanner.hide{opacity:0;transform:translateY(-10px)}.search-results-ad{max-height:100px;overflow:hidden}</style><ul id=results class="bg-white dark:bg-[#1f2937] rounded-lg shadow max-h-60 overflow-y-auto divide-y divide-gray-200 dark:divide-gray-600"></ul></div></div><main class="flex-1 w-full"><div class="max-w-7xl mx-auto py-8 px-4"><div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8 py-8"><article class="prose prose-blue dark:prose-invert lg:col-span-2"><nav class="text-sm text-gray-600 dark:text-gray-300 mb-4"><a href=/ class="text-gray-600 dark:text-gray-300 hover:text-[#0f7ea9] no-underline">Home</a>
<span class="mx-2 text-gray-400 dark:text-gray-500">/</span>
<a href=/tags/go class="text-gray-600 dark:text-gray-300 hover:text-[#0f7ea9] no-underline">#golang</a></nav><h1>API Gateway with Golang - Load Balancing and Rate Limiting Implementation</h1><div class="flex items-center gap-4 my-4 py-3 border-b border-gray-200 dark:border-gray-700"><span class="text-sm text-gray-500 dark:text-gray-400 font-medium mr-2">Share:</span>
<a href="https://twitter.com/intent/tweet?text=API+Gateway+with+Golang+-+Load+Balancing+and+Rate+Limiting+Implementation&url=https%3A%2F%2Fwww.buanacoding.com%2F2025%2F09%2Fapi-gateway-golang-load-balancing-rate-limiting.html&via=buanacoding" target=_blank rel=noopener class="p-2 text-gray-500 dark:text-gray-400 hover:text-black hover:bg-gray-100 dark:hover:text-white dark:hover:bg-gray-700 rounded-full transition-all duration-200" title="Share on Twitter"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
</a><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.buanacoding.com%2F2025%2F09%2Fapi-gateway-golang-load-balancing-rate-limiting.html" target=_blank rel=noopener class="p-2 text-gray-500 dark:text-gray-400 hover:text-blue-600 hover:bg-blue-50 dark:hover:text-blue-400 dark:hover:bg-blue-900/20 rounded-full transition-all duration-200" title="Share on Facebook"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312.0 2.686.235 2.686.235v2.953H15.83c-1.491.0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
</a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fwww.buanacoding.com%2F2025%2F09%2Fapi-gateway-golang-load-balancing-rate-limiting.html" target=_blank rel=noopener class="p-2 text-gray-500 dark:text-gray-400 hover:text-blue-700 hover:bg-blue-50 dark:hover:text-blue-400 dark:hover:bg-blue-900/20 rounded-full transition-all duration-200" title="Share on LinkedIn"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853.0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601.0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144.0-2.063-.926-2.063-2.065.0-1.138.92-2.063 2.063-2.063 1.14.0 2.064.925 2.064 2.063.0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225.0H1.771C.792.0.0.774.0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2.0 22.222.0h.003z"/></svg>
</a><a href="https://wa.me/?text=API+Gateway+with+Golang+-+Load+Balancing+and+Rate+Limiting+Implementation%20https%3A%2F%2Fwww.buanacoding.com%2F2025%2F09%2Fapi-gateway-golang-load-balancing-rate-limiting.html" target=_blank rel=noopener class="p-2 text-gray-500 dark:text-gray-400 hover:text-green-600 hover:bg-green-50 dark:hover:text-green-400 dark:hover:bg-green-900/20 rounded-full transition-all duration-200" title="Share on WhatsApp"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198.0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479.0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87.0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86.0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64.0 5.122 1.03 6.988 2.898a9.825 9.825.0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815.0 0012.05.0C5.495.0.16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882.0 005.683 1.448h.005c6.554.0 11.89-5.335 11.893-11.893A11.821 11.821.0 0020.484 3.488"/></svg>
</a><button onclick='copyLinkHeader("https://www.buanacoding.com/2025/09/api-gateway-golang-load-balancing-rate-limiting.html")' class="p-2 text-gray-500 dark:text-gray-400 hover:text-gray-800 hover:bg-gray-100 dark:hover:text-gray-200 dark:hover:bg-gray-700 rounded-full transition-all duration-200" title="Copy Link">
<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
</button>
<span id=copy-header-success class="hidden text-xs text-green-600 dark:text-green-400 font-medium">Copied!</span></div><script>function copyLinkHeader(e){navigator.clipboard.writeText(e).then(function(){showHeaderSuccess()}).catch(function(){const n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),showHeaderSuccess()})}function showHeaderSuccess(){const e=document.getElementById("copy-header-success");e.classList.remove("hidden"),setTimeout(function(){e.classList.add("hidden")},2e3)}</script><p>When you&rsquo;re building distributed systems, one component stands between chaos and order: the API Gateway. Think of it as the bouncer at an exclusive club - it decides who gets in, where they go, and how fast they can enter. After working with various microservice architectures, I can tell you that a well-implemented API Gateway is often the difference between a system that scales gracefully and one that crumbles under pressure.</p><p>Building an API Gateway might sound intimidating, but Go&rsquo;s excellent standard library and concurrency model make it surprisingly straightforward. Today, we&rsquo;ll build a complete API Gateway that handles load balancing across multiple backend services and implements intelligent rate limiting to protect your infrastructure from abuse.</p><p>The beauty of implementing this in Go lies in its simplicity and performance. While enterprise solutions like Kong or AWS API Gateway are fantastic, sometimes you need something tailored to your specific requirements. Plus, understanding how these systems work under the hood makes you a better architect.</p><div class="my-8 flex justify-center"><div class="w-full max-w-2xl"><div class="text-center mb-2"><span class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-medium">Advertisement</span></div><ins class="adsbygoogle lazy-ad" style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-3149036684216973 data-ad-slot=2492895769></ins></div></div><h2 id=why-you-need-an-api-gateway>Why You Need an API Gateway</h2><p>Before diving into implementation, let&rsquo;s understand why API Gateways have become essential in modern architectures. In a monolithic application, you typically have one entry point. But when you break that monolith into microservices, suddenly your client applications need to know about dozens of different service endpoints.</p><p>An API Gateway solves several critical problems. First, it provides a single entry point for all client requests, hiding the complexity of your backend architecture. Your mobile app doesn&rsquo;t need to know whether user authentication lives on one server while payment processing happens on another.</p><p>Second, it centralizes cross-cutting concerns like authentication, logging, and monitoring. Instead of implementing these features in every microservice, you handle them once at the gateway level. This reduces code duplication and ensures consistent behavior across your entire API surface.</p><p>Most importantly for our discussion today, it provides traffic management capabilities. Load balancing ensures your requests are distributed efficiently across healthy backend instances, while rate limiting protects your services from being overwhelmed by traffic spikes or malicious attacks.</p><h2 id=setting-up-the-project-structure>Setting Up the Project Structure</h2><p>Let&rsquo;s start with a clean project structure that will make our code maintainable and testable. If you&rsquo;re new to Go project organization, check out our guide on <a href=/2025/05/structuring-go-projects-clean-project-structure-and-best-practices.html>structuring Go projects with clean architecture
</a>for more detailed insights.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir api-gateway
</span></span><span class=line><span class=cl><span class=nb>cd</span> api-gateway
</span></span><span class=line><span class=cl>go mod init api-gateway
</span></span></code></pre></div><p>Create the following directory structure:</p><pre tabindex=0><code>api-gateway/
├── main.go
├── internal/
│   ├── gateway/
│   │   ├── gateway.go
│   │   ├── loadbalancer.go
│   │   └── ratelimiter.go
│   ├── config/
│   │   └── config.go
│   └── middleware/
│       ├── logging.go
│       └── recovery.go
├── pkg/
│   └── healthcheck/
│       └── healthcheck.go
└── configs/
    └── gateway.yaml
</code></pre><p>Install the required dependencies:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go get github.com/gorilla/mux
</span></span><span class=line><span class=cl>go get github.com/go-redis/redis/v8
</span></span><span class=line><span class=cl>go get golang.org/x/time/rate
</span></span><span class=line><span class=cl>go get gopkg.in/yaml.v2
</span></span></code></pre></div><h2 id=building-the-core-gateway-structure>Building the Core Gateway Structure</h2><p>Let&rsquo;s start with the configuration structure that will drive our gateway behavior:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// internal/config/config.go</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nx>config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;io/ioutil&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;gopkg.in/yaml.v2&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>Config</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>Gateway</span><span class=w>   </span><span class=nx>GatewayConfig</span><span class=w>   </span><span class=s>`yaml:&#34;gateway&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>Services</span><span class=w>  </span><span class=p>[]</span><span class=nx>ServiceConfig</span><span class=w> </span><span class=s>`yaml:&#34;services&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>RateLimit</span><span class=w> </span><span class=nx>RateLimitConfig</span><span class=w> </span><span class=s>`yaml:&#34;rateLimit&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>GatewayConfig</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>Port</span><span class=w>    </span><span class=kt>string</span><span class=w> </span><span class=s>`yaml:&#34;port&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>Timeout</span><span class=w> </span><span class=kt>int</span><span class=w>    </span><span class=s>`yaml:&#34;timeout&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>ServiceConfig</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>Name</span><span class=w>      </span><span class=kt>string</span><span class=w>   </span><span class=s>`yaml:&#34;name&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>Path</span><span class=w>      </span><span class=kt>string</span><span class=w>   </span><span class=s>`yaml:&#34;path&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>Instances</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=w> </span><span class=s>`yaml:&#34;instances&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>Strategy</span><span class=w>  </span><span class=kt>string</span><span class=w>   </span><span class=s>`yaml:&#34;strategy&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>RateLimitConfig</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>RequestsPerSecond</span><span class=w> </span><span class=kt>int</span><span class=w>    </span><span class=s>`yaml:&#34;requestsPerSecond&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>BurstSize</span><span class=w>         </span><span class=kt>int</span><span class=w>    </span><span class=s>`yaml:&#34;burstSize&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>RedisURL</span><span class=w>          </span><span class=kt>string</span><span class=w> </span><span class=s>`yaml:&#34;redisURL&#34;`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>LoadConfig</span><span class=p>(</span><span class=nx>path</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>Config</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ioutil</span><span class=p>.</span><span class=nf>ReadFile</span><span class=p>(</span><span class=nx>path</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>config</span><span class=w> </span><span class=nx>Config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>yaml</span><span class=p>.</span><span class=nf>Unmarshal</span><span class=p>(</span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=nx>config</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>config</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Create a configuration file that defines your services and policies:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># configs/gateway.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>gateway</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;:8080&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;user-service&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/api/users&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>instances</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;http://localhost:8081&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;http://localhost:8082&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;http://localhost:8083&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>strategy</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;round_robin&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;order-service&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/api/orders&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>instances</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;http://localhost:8084&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;http://localhost:8085&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>strategy</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;weighted_round_robin&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>rateLimit</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>requestsPerSecond</span><span class=p>:</span><span class=w> </span><span class=m>100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>burstSize</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>redisURL</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;redis://localhost:6379&#34;</span><span class=w>
</span></span></span></code></pre></div><h2 id=implementing-load-balancing-algorithms>Implementing Load Balancing Algorithms</h2><p>Now let&rsquo;s implement the heart of our gateway - the load balancer. We&rsquo;ll support multiple algorithms because different scenarios call for different strategies:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// internal/gateway/loadbalancer.go</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nx>gateway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;net/http&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;net/http/httputil&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;net/url&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;sync&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;sync/atomic&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;time&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>Backend</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>URL</span><span class=w>          </span><span class=o>*</span><span class=nx>url</span><span class=p>.</span><span class=nx>URL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>Alive</span><span class=w>        </span><span class=kt>bool</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>ReverseProxy</span><span class=w> </span><span class=o>*</span><span class=nx>httputil</span><span class=p>.</span><span class=nx>ReverseProxy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>Weight</span><span class=w>       </span><span class=kt>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>Connections</span><span class=w>  </span><span class=kt>int64</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>LoadBalancer</span><span class=w> </span><span class=kd>interface</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nf>GetNextBackend</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>Backend</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nf>MarkBackendStatus</span><span class=p>(</span><span class=nx>backend</span><span class=w> </span><span class=o>*</span><span class=nx>Backend</span><span class=p>,</span><span class=w> </span><span class=nx>alive</span><span class=w> </span><span class=kt>bool</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>RoundRobinBalancer</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>backends</span><span class=w> </span><span class=p>[]</span><span class=o>*</span><span class=nx>Backend</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>current</span><span class=w>  </span><span class=kt>uint64</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>mutex</span><span class=w>    </span><span class=nx>sync</span><span class=p>.</span><span class=nx>RWMutex</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>NewRoundRobinBalancer</span><span class=p>(</span><span class=nx>urls</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>RoundRobinBalancer</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>backends</span><span class=w> </span><span class=p>[]</span><span class=o>*</span><span class=nx>Backend</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>u</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>urls</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>url</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>url</span><span class=p>.</span><span class=nf>Parse</span><span class=p>(</span><span class=nx>u</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>backend</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>Backend</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>URL</span><span class=p>:</span><span class=w>          </span><span class=nx>url</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>Alive</span><span class=p>:</span><span class=w>        </span><span class=kc>true</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>ReverseProxy</span><span class=p>:</span><span class=w> </span><span class=nx>httputil</span><span class=p>.</span><span class=nf>NewSingleHostReverseProxy</span><span class=p>(</span><span class=nx>url</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>Weight</span><span class=p>:</span><span class=w>       </span><span class=mi>1</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>backends</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>backends</span><span class=p>,</span><span class=w> </span><span class=nx>backend</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>RoundRobinBalancer</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>backends</span><span class=p>:</span><span class=w> </span><span class=nx>backends</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>rb</span><span class=w> </span><span class=o>*</span><span class=nx>RoundRobinBalancer</span><span class=p>)</span><span class=w> </span><span class=nf>GetNextBackend</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>Backend</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>rb</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>RLock</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>defer</span><span class=w> </span><span class=nx>rb</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>RUnlock</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>rb</span><span class=p>.</span><span class=nx>backends</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>next</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>atomic</span><span class=p>.</span><span class=nf>AddUint64</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>rb</span><span class=p>.</span><span class=nx>current</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>rb</span><span class=p>.</span><span class=nx>backends</span><span class=p>[(</span><span class=nx>next</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>%</span><span class=nb>uint64</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=nx>rb</span><span class=p>.</span><span class=nx>backends</span><span class=p>))]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>rb</span><span class=w> </span><span class=o>*</span><span class=nx>RoundRobinBalancer</span><span class=p>)</span><span class=w> </span><span class=nf>MarkBackendStatus</span><span class=p>(</span><span class=nx>backend</span><span class=w> </span><span class=o>*</span><span class=nx>Backend</span><span class=p>,</span><span class=w> </span><span class=nx>alive</span><span class=w> </span><span class=kt>bool</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>rb</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>defer</span><span class=w> </span><span class=nx>rb</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>backend</span><span class=p>.</span><span class=nx>Alive</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>alive</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>WeightedRoundRobinBalancer</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>backends</span><span class=w>        </span><span class=p>[]</span><span class=o>*</span><span class=nx>Backend</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>currentWeights</span><span class=w>  </span><span class=p>[]</span><span class=kt>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>totalWeight</span><span class=w>     </span><span class=kt>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>mutex</span><span class=w>          </span><span class=nx>sync</span><span class=p>.</span><span class=nx>RWMutex</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>NewWeightedRoundRobinBalancer</span><span class=p>(</span><span class=nx>urls</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>weights</span><span class=w> </span><span class=p>[]</span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>WeightedRoundRobinBalancer</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>backends</span><span class=w> </span><span class=p>[]</span><span class=o>*</span><span class=nx>Backend</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>totalWeight</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=mi>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=p>,</span><span class=w> </span><span class=nx>u</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>urls</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>url</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>url</span><span class=p>.</span><span class=nf>Parse</span><span class=p>(</span><span class=nx>u</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>weight</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=p>&lt;</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>weights</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>weight</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>weights</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>backend</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>Backend</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>URL</span><span class=p>:</span><span class=w>          </span><span class=nx>url</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>Alive</span><span class=p>:</span><span class=w>        </span><span class=kc>true</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>ReverseProxy</span><span class=p>:</span><span class=w> </span><span class=nx>httputil</span><span class=p>.</span><span class=nf>NewSingleHostReverseProxy</span><span class=p>(</span><span class=nx>url</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>Weight</span><span class=p>:</span><span class=w>       </span><span class=nx>weight</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>backends</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>backends</span><span class=p>,</span><span class=w> </span><span class=nx>backend</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>totalWeight</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=nx>weight</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>WeightedRoundRobinBalancer</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>backends</span><span class=p>:</span><span class=w>       </span><span class=nx>backends</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>currentWeights</span><span class=p>:</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=kt>int</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>backends</span><span class=p>)),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>totalWeight</span><span class=p>:</span><span class=w>    </span><span class=nx>totalWeight</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>wrb</span><span class=w> </span><span class=o>*</span><span class=nx>WeightedRoundRobinBalancer</span><span class=p>)</span><span class=w> </span><span class=nf>GetNextBackend</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>Backend</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>wrb</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>defer</span><span class=w> </span><span class=nx>wrb</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>wrb</span><span class=p>.</span><span class=nx>backends</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>selected</span><span class=w> </span><span class=o>*</span><span class=nx>Backend</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>maxWeight</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>-</span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=p>,</span><span class=w> </span><span class=nx>backend</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>wrb</span><span class=p>.</span><span class=nx>backends</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>backend</span><span class=p>.</span><span class=nx>Alive</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>continue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>wrb</span><span class=p>.</span><span class=nx>currentWeights</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=nx>backend</span><span class=p>.</span><span class=nx>Weight</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>wrb</span><span class=p>.</span><span class=nx>currentWeights</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>&gt;</span><span class=w> </span><span class=nx>maxWeight</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>maxWeight</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>wrb</span><span class=p>.</span><span class=nx>currentWeights</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>selected</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>backend</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>selected</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=p>,</span><span class=w> </span><span class=nx>backend</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>wrb</span><span class=p>.</span><span class=nx>backends</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=nx>backend</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=nx>selected</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nx>wrb</span><span class=p>.</span><span class=nx>currentWeights</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=o>-=</span><span class=w> </span><span class=nx>wrb</span><span class=p>.</span><span class=nx>totalWeight</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>break</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>selected</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>wrb</span><span class=w> </span><span class=o>*</span><span class=nx>WeightedRoundRobinBalancer</span><span class=p>)</span><span class=w> </span><span class=nf>MarkBackendStatus</span><span class=p>(</span><span class=nx>backend</span><span class=w> </span><span class=o>*</span><span class=nx>Backend</span><span class=p>,</span><span class=w> </span><span class=nx>alive</span><span class=w> </span><span class=kt>bool</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>wrb</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>defer</span><span class=w> </span><span class=nx>wrb</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>backend</span><span class=p>.</span><span class=nx>Alive</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>alive</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=implementing-rate-limiting>Implementing Rate Limiting</h2><p>Rate limiting is crucial for protecting your backend services from abuse. We&rsquo;ll implement both in-memory and Redis-based rate limiting:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// internal/gateway/ratelimiter.go</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nx>gateway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;context&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;fmt&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;net/http&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;time&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;github.com/go-redis/redis/v8&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;golang.org/x/time/rate&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>RateLimiter</span><span class=w> </span><span class=kd>interface</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nf>Allow</span><span class=p>(</span><span class=nx>clientID</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=kt>bool</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>InMemoryRateLimiter</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>limiters</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=o>*</span><span class=nx>rate</span><span class=p>.</span><span class=nx>Limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>rate</span><span class=w>     </span><span class=nx>rate</span><span class=p>.</span><span class=nx>Limit</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>burst</span><span class=w>    </span><span class=kt>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>NewInMemoryRateLimiter</span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=nx>rate</span><span class=p>.</span><span class=nx>Limit</span><span class=p>,</span><span class=w> </span><span class=nx>b</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>InMemoryRateLimiter</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>InMemoryRateLimiter</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>limiters</span><span class=p>:</span><span class=w> </span><span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=o>*</span><span class=nx>rate</span><span class=p>.</span><span class=nx>Limiter</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>rate</span><span class=p>:</span><span class=w>     </span><span class=nx>r</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>burst</span><span class=p>:</span><span class=w>    </span><span class=nx>b</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>rl</span><span class=w> </span><span class=o>*</span><span class=nx>InMemoryRateLimiter</span><span class=p>)</span><span class=w> </span><span class=nf>Allow</span><span class=p>(</span><span class=nx>clientID</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>limiter</span><span class=p>,</span><span class=w> </span><span class=nx>exists</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>rl</span><span class=p>.</span><span class=nx>limiters</span><span class=p>[</span><span class=nx>clientID</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>exists</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>limiter</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>rate</span><span class=p>.</span><span class=nf>NewLimiter</span><span class=p>(</span><span class=nx>rl</span><span class=p>.</span><span class=nx>rate</span><span class=p>,</span><span class=w> </span><span class=nx>rl</span><span class=p>.</span><span class=nx>burst</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>rl</span><span class=p>.</span><span class=nx>limiters</span><span class=p>[</span><span class=nx>clientID</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>limiter</span><span class=p>.</span><span class=nf>Allow</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>RedisRateLimiter</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>client</span><span class=w> </span><span class=o>*</span><span class=nx>redis</span><span class=p>.</span><span class=nx>Client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>window</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Duration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>limit</span><span class=w>  </span><span class=kt>int64</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>NewRedisRateLimiter</span><span class=p>(</span><span class=nx>redisURL</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>window</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Duration</span><span class=p>,</span><span class=w> </span><span class=nx>limit</span><span class=w> </span><span class=kt>int64</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>RedisRateLimiter</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>opt</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>redis</span><span class=p>.</span><span class=nf>ParseURL</span><span class=p>(</span><span class=nx>redisURL</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>client</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>redis</span><span class=p>.</span><span class=nf>NewClient</span><span class=p>(</span><span class=nx>opt</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>RedisRateLimiter</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>client</span><span class=p>:</span><span class=w> </span><span class=nx>client</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>window</span><span class=p>:</span><span class=w> </span><span class=nx>window</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>limit</span><span class=p>:</span><span class=w>  </span><span class=nx>limit</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=kc>nil</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>rl</span><span class=w> </span><span class=o>*</span><span class=nx>RedisRateLimiter</span><span class=p>)</span><span class=w> </span><span class=nf>Allow</span><span class=p>(</span><span class=nx>clientID</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>ctx</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>now</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>key</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;rate_limit:%s&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>clientID</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>pipe</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>rl</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nf>TxPipeline</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Remove expired entries</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>pipe</span><span class=p>.</span><span class=nf>ZRemRangeByScore</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>key</span><span class=p>,</span><span class=w> </span><span class=s>&#34;0&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>now</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=o>-</span><span class=nx>rl</span><span class=p>.</span><span class=nx>window</span><span class=p>).</span><span class=nf>UnixNano</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Add current request</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>pipe</span><span class=p>.</span><span class=nf>ZAdd</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>key</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=nx>redis</span><span class=p>.</span><span class=nx>Z</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>Score</span><span class=p>:</span><span class=w>  </span><span class=nb>float64</span><span class=p>(</span><span class=nx>now</span><span class=p>.</span><span class=nf>UnixNano</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>Member</span><span class=p>:</span><span class=w> </span><span class=nx>now</span><span class=p>.</span><span class=nf>UnixNano</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Count requests in window</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>countCmd</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>pipe</span><span class=p>.</span><span class=nf>ZCard</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>key</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Set expiration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>pipe</span><span class=p>.</span><span class=nf>Expire</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>key</span><span class=p>,</span><span class=w> </span><span class=nx>rl</span><span class=p>.</span><span class=nx>window</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>pipe</span><span class=p>.</span><span class=nf>Exec</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>count</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>countCmd</span><span class=p>.</span><span class=nf>Val</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>count</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=nx>rl</span><span class=p>.</span><span class=nx>limit</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=building-the-gateway-core>Building the Gateway Core</h2><p>Now let&rsquo;s tie everything together in our main gateway implementation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// internal/gateway/gateway.go</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nx>gateway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;log&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;net/http&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;net/http/httputil&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;strings&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;time&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;api-gateway/internal/config&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>Gateway</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>config</span><span class=w>       </span><span class=o>*</span><span class=nx>config</span><span class=p>.</span><span class=nx>Config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>loadBalancer</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=nx>LoadBalancer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>rateLimiter</span><span class=w>  </span><span class=nx>RateLimiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>NewGateway</span><span class=p>(</span><span class=nx>cfg</span><span class=w> </span><span class=o>*</span><span class=nx>config</span><span class=p>.</span><span class=nx>Config</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>Gateway</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>gateway</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>Gateway</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>config</span><span class=p>:</span><span class=w>       </span><span class=nx>cfg</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>loadBalancer</span><span class=p>:</span><span class=w> </span><span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=nx>LoadBalancer</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Initialize load balancers for each service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>service</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>cfg</span><span class=p>.</span><span class=nx>Services</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>switch</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Strategy</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=s>&#34;round_robin&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>gateway</span><span class=p>.</span><span class=nx>loadBalancer</span><span class=p>[</span><span class=nx>service</span><span class=p>.</span><span class=nx>Name</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nf>NewRoundRobinBalancer</span><span class=p>(</span><span class=nx>service</span><span class=p>.</span><span class=nx>Instances</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=s>&#34;weighted_round_robin&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// For simplicity, using equal weights. In production, you&#39;d read weights from config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>weights</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=kt>int</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>service</span><span class=p>.</span><span class=nx>Instances</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>weights</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nx>weights</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>gateway</span><span class=p>.</span><span class=nx>loadBalancer</span><span class=p>[</span><span class=nx>service</span><span class=p>.</span><span class=nx>Name</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nf>NewWeightedRoundRobinBalancer</span><span class=p>(</span><span class=nx>service</span><span class=p>.</span><span class=nx>Instances</span><span class=p>,</span><span class=w> </span><span class=nx>weights</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>gateway</span><span class=p>.</span><span class=nx>loadBalancer</span><span class=p>[</span><span class=nx>service</span><span class=p>.</span><span class=nx>Name</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nf>NewRoundRobinBalancer</span><span class=p>(</span><span class=nx>service</span><span class=p>.</span><span class=nx>Instances</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Initialize rate limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>cfg</span><span class=p>.</span><span class=nx>RateLimit</span><span class=p>.</span><span class=nx>RedisURL</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>rl</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nf>NewRedisRateLimiter</span><span class=p>(</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>RateLimit</span><span class=p>.</span><span class=nx>RedisURL</span><span class=p>,</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>,</span><span class=w> </span><span class=nb>int64</span><span class=p>(</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>RateLimit</span><span class=p>.</span><span class=nx>RequestsPerSecond</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>gateway</span><span class=p>.</span><span class=nx>rateLimiter</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>rl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>gateway</span><span class=p>.</span><span class=nx>rateLimiter</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nf>NewInMemoryRateLimiter</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>rate</span><span class=p>.</span><span class=nf>Limit</span><span class=p>(</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>RateLimit</span><span class=p>.</span><span class=nx>RequestsPerSecond</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>cfg</span><span class=p>.</span><span class=nx>RateLimit</span><span class=p>.</span><span class=nx>BurstSize</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>gateway</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>g</span><span class=w> </span><span class=o>*</span><span class=nx>Gateway</span><span class=p>)</span><span class=w> </span><span class=nf>ServeHTTP</span><span class=p>(</span><span class=nx>w</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span><span class=w> </span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Rate limiting</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>clientID</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>g</span><span class=p>.</span><span class=nf>getClientID</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>g</span><span class=p>.</span><span class=nx>rateLimiter</span><span class=p>.</span><span class=nf>Allow</span><span class=p>(</span><span class=nx>clientID</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Rate limit exceeded&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusTooManyRequests</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Find matching service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>service</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>g</span><span class=p>.</span><span class=nf>findService</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>URL</span><span class=p>.</span><span class=nx>Path</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>service</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Service not found&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusNotFound</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Get backend from load balancer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>lb</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>g</span><span class=p>.</span><span class=nx>loadBalancer</span><span class=p>[</span><span class=nx>service</span><span class=p>.</span><span class=nx>Name</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>backend</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>lb</span><span class=p>.</span><span class=nf>GetNextBackend</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>backend</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>!</span><span class=nx>backend</span><span class=p>.</span><span class=nx>Alive</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span><span class=w> </span><span class=s>&#34;No healthy backends available&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusServiceUnavailable</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Update request path</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>URL</span><span class=p>.</span><span class=nx>Path</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>strings</span><span class=p>.</span><span class=nf>TrimPrefix</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>URL</span><span class=p>.</span><span class=nx>Path</span><span class=p>,</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Path</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>URL</span><span class=p>.</span><span class=nx>Host</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>backend</span><span class=p>.</span><span class=nx>URL</span><span class=p>.</span><span class=nx>Host</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>URL</span><span class=p>.</span><span class=nx>Scheme</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>backend</span><span class=p>.</span><span class=nx>URL</span><span class=p>.</span><span class=nx>Scheme</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>Header</span><span class=p>.</span><span class=nf>Set</span><span class=p>(</span><span class=s>&#34;X-Forwarded-Host&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>Header</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=s>&#34;Host&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>Header</span><span class=p>.</span><span class=nf>Set</span><span class=p>(</span><span class=s>&#34;X-Origin-Host&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>backend</span><span class=p>.</span><span class=nx>URL</span><span class=p>.</span><span class=nx>Host</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Proxy the request</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>backend</span><span class=p>.</span><span class=nx>ReverseProxy</span><span class=p>.</span><span class=nf>ServeHTTP</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span><span class=w> </span><span class=nx>r</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>g</span><span class=w> </span><span class=o>*</span><span class=nx>Gateway</span><span class=p>)</span><span class=w> </span><span class=nf>getClientID</span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// In production, you might use API keys, JWT sub claims, or IP addresses</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>clientIP</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>Header</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=s>&#34;X-Forwarded-For&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>clientIP</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>clientIP</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>Header</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=s>&#34;X-Real-IP&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>clientIP</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>clientIP</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>RemoteAddr</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>clientIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>g</span><span class=w> </span><span class=o>*</span><span class=nx>Gateway</span><span class=p>)</span><span class=w> </span><span class=nf>findService</span><span class=p>(</span><span class=nx>path</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>config</span><span class=p>.</span><span class=nx>ServiceConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>service</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>g</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>Services</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>strings</span><span class=p>.</span><span class=nf>HasPrefix</span><span class=p>(</span><span class=nx>path</span><span class=p>,</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>Path</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=adding-health-checks-and-monitoring>Adding Health Checks and Monitoring</h2><p>A production API Gateway needs robust health checking to remove unhealthy backends from rotation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// pkg/healthcheck/healthcheck.go</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nx>healthcheck</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;net/http&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;time&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>IsBackendHealthy</span><span class=p>(</span><span class=nx>url</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>timeout</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Duration</span><span class=p>)</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>client</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>http</span><span class=p>.</span><span class=nx>Client</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>Timeout</span><span class=p>:</span><span class=w> </span><span class=nx>timeout</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>resp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>client</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=nx>url</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;/health&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>defer</span><span class=w> </span><span class=nx>resp</span><span class=p>.</span><span class=nx>Body</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>resp</span><span class=p>.</span><span class=nx>StatusCode</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>StartHealthChecker</span><span class=p>(</span><span class=nx>backends</span><span class=w> </span><span class=p>[]</span><span class=o>*</span><span class=nx>Backend</span><span class=p>,</span><span class=w> </span><span class=nx>interval</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Duration</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>ticker</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nf>NewTicker</span><span class=p>(</span><span class=nx>interval</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>go</span><span class=w> </span><span class=kd>func</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>ticker</span><span class=p>.</span><span class=nx>C</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>backend</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>backends</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nx>healthy</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nf>IsBackendHealthy</span><span class=p>(</span><span class=nx>backend</span><span class=p>.</span><span class=nx>URL</span><span class=p>.</span><span class=nf>String</span><span class=p>(),</span><span class=w> </span><span class=mi>5</span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nx>backend</span><span class=p>.</span><span class=nx>Alive</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>healthy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=putting-it-all-together>Putting It All Together</h2><p>Finally, let&rsquo;s create our main application that brings all components together:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// main.go</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nx>main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;log&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;net/http&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;time&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;api-gateway/internal/config&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;api-gateway/internal/gateway&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;github.com/gorilla/mux&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Load configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>cfg</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>config</span><span class=p>.</span><span class=nf>LoadConfig</span><span class=p>(</span><span class=s>&#34;configs/gateway.yaml&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=s>&#34;Failed to load config:&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Create gateway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>gw</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>gateway</span><span class=p>.</span><span class=nf>NewGateway</span><span class=p>(</span><span class=nx>cfg</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=s>&#34;Failed to create gateway:&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Setup routes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>router</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>mux</span><span class=p>.</span><span class=nf>NewRouter</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>router</span><span class=p>.</span><span class=nf>PathPrefix</span><span class=p>(</span><span class=s>&#34;/&#34;</span><span class=p>).</span><span class=nf>Handler</span><span class=p>(</span><span class=nx>gw</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Configure server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>server</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>http</span><span class=p>.</span><span class=nx>Server</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>Addr</span><span class=p>:</span><span class=w>         </span><span class=nx>cfg</span><span class=p>.</span><span class=nx>Gateway</span><span class=p>.</span><span class=nx>Port</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>Handler</span><span class=p>:</span><span class=w>      </span><span class=nx>router</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>ReadTimeout</span><span class=p>:</span><span class=w>  </span><span class=nx>time</span><span class=p>.</span><span class=nf>Duration</span><span class=p>(</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>Gateway</span><span class=p>.</span><span class=nx>Timeout</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>WriteTimeout</span><span class=p>:</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nf>Duration</span><span class=p>(</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>Gateway</span><span class=p>.</span><span class=nx>Timeout</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;API Gateway starting on %s&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>cfg</span><span class=p>.</span><span class=nx>Gateway</span><span class=p>.</span><span class=nx>Port</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=nx>server</span><span class=p>.</span><span class=nf>ListenAndServe</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=testing-your-api-gateway>Testing Your API Gateway</h2><p>To test your gateway, you&rsquo;ll need some backend services. Here&rsquo;s a simple test server you can run on different ports:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// test-server/main.go</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nx>main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;encoding/json&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;flag&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;log&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;net/http&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;os&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>port</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>flag</span><span class=p>.</span><span class=nf>String</span><span class=p>(</span><span class=s>&#34;port&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;8081&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Server port&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>flag</span><span class=p>.</span><span class=nf>Parse</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>http</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/health&#34;</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>w</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span><span class=w> </span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>w</span><span class=p>.</span><span class=nf>WriteHeader</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>json</span><span class=p>.</span><span class=nf>NewEncoder</span><span class=p>(</span><span class=nx>w</span><span class=p>).</span><span class=nf>Encode</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;status&#34;</span><span class=p>:</span><span class=w> </span><span class=s>&#34;healthy&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;port&#34;</span><span class=p>:</span><span class=w> </span><span class=o>*</span><span class=nx>port</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>http</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/&#34;</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>w</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span><span class=w> </span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>hostname</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nf>Hostname</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>response</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;message&#34;</span><span class=p>:</span><span class=w>  </span><span class=s>&#34;Hello from backend&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;port&#34;</span><span class=p>:</span><span class=w>     </span><span class=o>*</span><span class=nx>port</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;hostname&#34;</span><span class=p>:</span><span class=w> </span><span class=nx>hostname</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;path&#34;</span><span class=p>:</span><span class=w>     </span><span class=nx>r</span><span class=p>.</span><span class=nx>URL</span><span class=p>.</span><span class=nx>Path</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>json</span><span class=p>.</span><span class=nf>NewEncoder</span><span class=p>(</span><span class=nx>w</span><span class=p>).</span><span class=nf>Encode</span><span class=p>(</span><span class=nx>response</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Test server starting on :%s&#34;</span><span class=p>,</span><span class=w> </span><span class=o>*</span><span class=nx>port</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nf>ListenAndServe</span><span class=p>(</span><span class=s>&#34;:&#34;</span><span class=o>+*</span><span class=nx>port</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Run multiple instances:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go run test-server/main.go -port<span class=o>=</span><span class=m>8081</span> <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>go run test-server/main.go -port<span class=o>=</span><span class=m>8082</span> <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>go run test-server/main.go -port<span class=o>=</span><span class=m>8083</span> <span class=p>&amp;</span>
</span></span></code></pre></div><p>Then start your gateway and test it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go run main.go
</span></span><span class=line><span class=cl>curl http://localhost:8080/api/users/profile
</span></span></code></pre></div><h2 id=performance-considerations-and-best-practices>Performance Considerations and Best Practices</h2><p>When building production API Gateways, performance is paramount. Go&rsquo;s goroutines make it naturally well-suited for this task, but there are several optimizations to consider.</p><p>First, connection pooling is crucial. The default HTTP client in Go reuses connections, but you should tune the transport settings based on your expected load. Consider setting MaxIdleConns and MaxIdleConnsPerHost appropriately.</p><p>For rate limiting, Redis provides better scalability across multiple gateway instances, but in-memory limiting offers lower latency. Choose based on your architecture - if you&rsquo;re running a single gateway instance, in-memory might be sufficient.</p><p>Health checking frequency should balance between quick failure detection and unnecessary load on your backends. Start with 30-second intervals and adjust based on your requirements.</p><p>Monitoring and observability are essential. Consider integrating with <a href=/2025/09/complete-guide-slog-go-structured-logging-2025.html>structured logging in Go using slog
</a>to get better insights into your gateway&rsquo;s behavior.</p><h2 id=extending-your-gateway>Extending Your Gateway</h2><p>This implementation provides a solid foundation, but production gateways often need additional features. Consider adding authentication middleware, request/response transformation, circuit breakers for handling backend failures gracefully, and metrics collection for monitoring.</p><p>You might also want to implement more sophisticated load balancing algorithms like least connections or consistent hashing, especially if you&rsquo;re dealing with stateful backends or want to optimize cache hit rates.</p><p>For high-availability deployments, consider how you&rsquo;ll handle configuration updates without downtime and how multiple gateway instances will coordinate, especially for features like rate limiting that require shared state.</p><p>Building an API Gateway in Go gives you complete control over your traffic management logic while leveraging Go&rsquo;s excellent performance characteristics. Start with this foundation and extend it based on your specific requirements. The modular design makes it easy to add new features without disrupting existing functionality.</p><p>Remember that an API Gateway is a critical piece of infrastructure - invest time in testing, monitoring, and documentation. Your future self and your team will thank you when it&rsquo;s 3 AM and you need to debug a production issue.</p></p><div class="bg-gray-100 dark:bg-gray-800 p-4 my-8 rounded"><h2 class="text-lg font-semibold mb-2">📌 Read Also</h2><ul class="list-disc list-outside ml-5"><li><a href=/2025/11/how-to-implement-passkey-authentication-go-webauthn.html class="text-gray-900 dark:text-white hover:text-[#0f7ea9] no-underline">How to Implement Passkey Authentication with Go - WebAuthn Tutorial</a></li><li><a href=/2025/10/how-to-implement-message-queuing-with-rabbitmq-in-go.html class="text-gray-900 dark:text-white hover:text-[#0f7ea9] no-underline">How to Implement Message Queuing with RabbitMQ in Go</a></li><li><a href=/2025/10/how-to-build-ai-llm-applications-in-go-openai-and-ollama-integration.html class="text-gray-900 dark:text-white hover:text-[#0f7ea9] no-underline">How to Build AI/LLM Applications in Go - OpenAI and Ollama Integration</a></li></ul></div><div class="hidden lg:block"><div class="my-8 py-6 border-t border-b border-gray-200 dark:border-gray-700"><div class="max-w-4xl mx-auto"><div class="text-center mb-3"><span class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-medium">Advertisement</span></div><div class="flex justify-center"><ins class="adsbygoogle lazy-ad" style=display:block;min-height:90px;max-width:100% data-ad-client=ca-pub-3149036684216973 data-ad-slot=3879195288 data-ad-format=auto data-full-width-responsive=true></ins></div></div></div></div><div class="block lg:hidden my-8 px-2 mb-10"><div class="text-center mb-2"><span class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-medium">Advertisement</span></div><div class="flex justify-center"><ins class="adsbygoogle lazy-ad" style=display:block;min-height:50px;max-width:100% data-ad-client=ca-pub-3149036684216973 data-ad-slot=3879195288 data-ad-format=auto data-full-width-responsive=true></ins></div></div><div class="lg:hidden mt-8 pt-8 border-t border-gray-200 dark:border-gray-700"><h3 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">Popular Posts</h3><div class="grid gap-3"><a href=/2025/11/developer-roadmap-2025-skills-you-need-to-get-hired.html class="block py-2 hover:text-[#0f7ea9] transition no-underline"><h4 class="font-medium text-gray-900 dark:text-white text-sm mb-1">Developer Roadmap 2025: Skills You Need to Get Hired</h4><p class="text-xs text-gray-500 dark:text-gray-400">29 Nov 2025</p></a><a href=/2025/11/best-programming-language-to-learn-in-2025-for-beginners.html class="block py-2 hover:text-[#0f7ea9] transition no-underline"><h4 class="font-medium text-gray-900 dark:text-white text-sm mb-1">Best Programming Language to Learn in 2025 for Beginners</h4><p class="text-xs text-gray-500 dark:text-gray-400">29 Nov 2025</p></a><a href=/2025/11/how-to-implement-passkey-authentication-go-webauthn.html class="block py-2 hover:text-[#0f7ea9] transition no-underline"><h4 class="font-medium text-gray-900 dark:text-white text-sm mb-1">How to Implement Passkey Authentication with Go - WebAuthn Tutorial</h4><p class="text-xs text-gray-500 dark:text-gray-400">09 Nov 2025</p></a><a href=/2025/10/how-to-build-rest-api-django-rest-framework-production-ready.html class="block py-2 hover:text-[#0f7ea9] transition no-underline"><h4 class="font-medium text-gray-900 dark:text-white text-sm mb-1">How to Build a REST API with Django REST Framework (Production Ready)</h4><p class="text-xs text-gray-500 dark:text-gray-400">29 Oct 2025</p></a><a href=/2025/10/python-automation-scripts-every-developer-should-know.html class="block py-2 hover:text-[#0f7ea9] transition no-underline"><h4 class="font-medium text-gray-900 dark:text-white text-sm mb-1">Python Automation Scripts Every Developer Should Know (Save Hours Weekly)</h4><p class="text-xs text-gray-500 dark:text-gray-400">28 Oct 2025</p></a></div></div><div class="my-8 py-6"><div class="max-w-4xl mx-auto"><div class="text-center mb-3"><span class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-medium">Advertisement</span></div><div class="flex justify-center"><ins class="adsbygoogle lazy-ad" style=display:block data-ad-format=autorelaxed data-ad-client=ca-pub-3149036684216973 data-ad-slot=7106179106></ins></div></div></div><div class="not-prose my-12 -mx-4 sm:-mx-6 lg:mx-0"><div class=max-w-full><div class=mb-8><h2 class="text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white mb-2">Frequently Asked Questions</h2><p class="text-gray-600 dark:text-gray-400">Find quick answers to common questions</p></div><ul class="faq-list space-y-0 list-none p-0 m-0"><li class="faq-item border-b border-gray-200 dark:border-gray-700" itemscope itemprop=mainEntity itemtype=https://schema.org/Question><details class=faq-details><summary class="cursor-pointer list-none py-5 md:py-6 flex items-start justify-between gap-6 select-none focus:outline-none hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors duration-150" itemprop=name><h3 class="font-semibold text-base md:text-lg text-gray-900 dark:text-white leading-[1.6] m-0 flex-1">What's the difference between Round Robin and Weighted Round Robin load balancing?</h3><span class="faq-arrow flex-shrink-0 mt-1"><svg class="w-5 h-5 text-gray-600 dark:text-gray-400 transition-transform duration-200 ease-in-out" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg></span></summary><div class="pb-6 pt-2" itemscope itemprop=acceptedAnswer itemtype=https://schema.org/Answer><div class="text-gray-700 dark:text-gray-300 leading-[1.7] text-[15px] md:text-base prose prose-gray dark:prose-invert max-w-none prose-p:my-2.5 prose-p:leading-[1.7] prose-code:bg-gray-100 dark:prose-code:bg-gray-700 prose-code:px-2 prose-code:py-1 prose-code:rounded prose-code:text-sm prose-code:font-mono" itemprop=text>Round Robin distributes requests equally&ndash;each backend gets same number of requests in rotation: Backend1 -> Backend2 -> Backend3 -> repeat. Simple, fair for identical backends. Weighted Round Robin assigns different traffic proportions based on backend capacity&ndash;powerful server gets weight 3, weaker gets weight 1, so powerful server handles 3× traffic. Use Round Robin when: all backends identical specs, simple setup needed. Use Weighted when: mixed server specs (8-core and 4-core instances), gradual migration (new version weight 1, old version weight 9 during canary deploy), premium/economy tiers. Algorithm: Weighted tracks current weights, increments by backend&rsquo;s weight each round, selects highest, then subtracts total weight from selected. Ensures proportional distribution over time. Production: most start with Round Robin, switch to Weighted when adding heterogeneous backends or doing canary releases.</div></div></details></li><li class="faq-item border-b border-gray-200 dark:border-gray-700" itemscope itemprop=mainEntity itemtype=https://schema.org/Question><details class=faq-details><summary class="cursor-pointer list-none py-5 md:py-6 flex items-start justify-between gap-6 select-none focus:outline-none hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors duration-150" itemprop=name><h3 class="font-semibold text-base md:text-lg text-gray-900 dark:text-white leading-[1.6] m-0 flex-1">Should I use in-memory or Redis-based rate limiting for production?</h3><span class="faq-arrow flex-shrink-0 mt-1"><svg class="w-5 h-5 text-gray-600 dark:text-gray-400 transition-transform duration-200 ease-in-out" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg></span></summary><div class="pb-6 pt-2" itemscope itemprop=acceptedAnswer itemtype=https://schema.org/Answer><div class="text-gray-700 dark:text-gray-300 leading-[1.7] text-[15px] md:text-base prose prose-gray dark:prose-invert max-w-none prose-p:my-2.5 prose-p:leading-[1.7] prose-code:bg-gray-100 dark:prose-code:bg-gray-700 prose-code:px-2 prose-code:py-1 prose-code:rounded prose-code:text-sm prose-code:font-mono" itemprop=text>Use Redis for distributed systems (multiple gateway instances), in-memory for single instance. In-memory rate limiting: (1) Faster&ndash;no network latency, ~1μs decision. (2) Simple&ndash;no external dependency. (3) Per-instance&ndash;if 3 gateways, each allows 100 req/s = 300 total. (4) Lost on restart&ndash;limits reset. Use when: single gateway, low traffic, development. Redis rate limiting: (1) Centralized&ndash;all gateways share limits, 100 req/s total across all instances. (2) Persistent&ndash;survives gateway restarts. (3) Slower&ndash;network round trip adds ~1-5ms. (4) Scales horizontally. Use when: multiple gateways, need exact limits, high availability. Hybrid approach: in-memory for first-pass (fast rejection), Redis for accurate tracking (check only if in-memory allows). Implementation: use golang.org/x/time/rate for in-memory, sorted sets in Redis for sliding window. Production: start in-memory for speed, add Redis when scaling to multiple instances.</div></div></details></li><li class="faq-item border-b border-gray-200 dark:border-gray-700" itemscope itemprop=mainEntity itemtype=https://schema.org/Question><details class=faq-details><summary class="cursor-pointer list-none py-5 md:py-6 flex items-start justify-between gap-6 select-none focus:outline-none hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors duration-150" itemprop=name><h3 class="font-semibold text-base md:text-lg text-gray-900 dark:text-white leading-[1.6] m-0 flex-1">How do I handle backend health checks without overloading backends?</h3><span class="faq-arrow flex-shrink-0 mt-1"><svg class="w-5 h-5 text-gray-600 dark:text-gray-400 transition-transform duration-200 ease-in-out" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg></span></summary><div class="pb-6 pt-2" itemscope itemprop=acceptedAnswer itemtype=https://schema.org/Answer><div class="text-gray-700 dark:text-gray-300 leading-[1.7] text-[15px] md:text-base prose prose-gray dark:prose-invert max-w-none prose-p:my-2.5 prose-p:leading-[1.7] prose-code:bg-gray-100 dark:prose-code:bg-gray-700 prose-code:px-2 prose-code:py-1 prose-code:rounded prose-code:text-sm prose-code:font-mono" itemprop=text>Passive health checks + adaptive active checks. Passive: track request failures&ndash;if backend returns 3 consecutive 5xx errors, mark unhealthy, retry after cooldown. No extra load, reacts to real traffic. Active: periodic health endpoint checks&ndash;but smart intervals: (1) Start with 30s for healthy backends. (2) Increase to 10s if one 5xx seen (warning state). (3) Check every 5s when marked unhealthy (trying to recover). (4) Return to 30s after 3 successful checks. Avoid: checking every 1s&ndash;10 backends = 10 req/s just for health, wastes resources. Health endpoint: lightweight /health that checks: (1) Can connect to database (connection pool check, not query). (2) Disk not full. (3) Memory available. Don&rsquo;t: run expensive queries, external API calls. Circuit breaker pattern: after 5 consecutive failures, open circuit (stop sending traffic), half-open after 30s (send 1 test request), close if succeeds. Code: track lastHealthCheck timestamp, adjust interval based on state. This balances quick failure detection with minimal overhead.</div></div></details></li><li class="faq-item border-b border-gray-200 dark:border-gray-700" itemscope itemprop=mainEntity itemtype=https://schema.org/Question><details class=faq-details><summary class="cursor-pointer list-none py-5 md:py-6 flex items-start justify-between gap-6 select-none focus:outline-none hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors duration-150" itemprop=name><h3 class="font-semibold text-base md:text-lg text-gray-900 dark:text-white leading-[1.6] m-0 flex-1">Why does my API Gateway run out of file descriptors in production?</h3><span class="faq-arrow flex-shrink-0 mt-1"><svg class="w-5 h-5 text-gray-600 dark:text-gray-400 transition-transform duration-200 ease-in-out" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg></span></summary><div class="pb-6 pt-2" itemscope itemprop=acceptedAnswer itemtype=https://schema.org/Answer><div class="text-gray-700 dark:text-gray-300 leading-[1.7] text-[15px] md:text-base prose prose-gray dark:prose-invert max-w-none prose-p:my-2.5 prose-p:leading-[1.7] prose-code:bg-gray-100 dark:prose-code:bg-gray-700 prose-code:px-2 prose-code:py-1 prose-code:rounded prose-code:text-sm prose-code:font-mono" itemprop=text>File descriptor exhaustion happens when gateway opens more connections than OS limit. Each backend connection + client connection uses FD. Default limit often 1024, production needs 10k-100k. Causes: (1) No connection reuse&ndash;creating new HTTP client per request instead of shared client with connection pool. (2) No timeouts&ndash;hung connections never close. (3) Too many backends&ndash;100 backends × 100 idle conns = 10k FDs. (4) Leaking connections&ndash;not closing response bodies: resp.Body.Close(). Fixes: (1) Shared HTTP client: var client = &amp;http.Client{Transport: &amp;http.Transport{MaxIdleConns: 100, MaxIdleConnsPerHost: 10}}. (2) Set timeouts: ReadTimeout, WriteTimeout on http.Server. (3) OS limits: ulimit -n 65535, or systemd LimitNOFILE=65535. (4) Close bodies: defer resp.Body.Close() after every request. (5) Monitor: track open FDs with lsof -p <pid>| wc -l. (6) Connection pooling: reuse connections via keep-alive. Production tuning: start with MaxIdleConnsPerHost=50, adjust based on load testing. Each backend connection stays open ~90s by default, plan accordingly.</div></div></details></li><li class="faq-item border-b border-gray-200 dark:border-gray-700" itemscope itemprop=mainEntity itemtype=https://schema.org/Question><details class=faq-details><summary class="cursor-pointer list-none py-5 md:py-6 flex items-start justify-between gap-6 select-none focus:outline-none hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors duration-150" itemprop=name><h3 class="font-semibold text-base md:text-lg text-gray-900 dark:text-white leading-[1.6] m-0 flex-1">How do I implement per-user rate limiting instead of per-IP?</h3><span class="faq-arrow flex-shrink-0 mt-1"><svg class="w-5 h-5 text-gray-600 dark:text-gray-400 transition-transform duration-200 ease-in-out" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg></span></summary><div class="pb-6 pt-2" itemscope itemprop=acceptedAnswer itemtype=https://schema.org/Answer><div class="text-gray-700 dark:text-gray-300 leading-[1.7] text-[15px] md:text-base prose prose-gray dark:prose-invert max-w-none prose-p:my-2.5 prose-p:leading-[1.7] prose-code:bg-gray-100 dark:prose-code:bg-gray-700 prose-code:px-2 prose-code:py-1 prose-code:rounded prose-code:text-sm prose-code:font-mono" itemprop=text>Extract user ID from authentication token instead of IP address. Implementation: (1) Parse JWT/API key from Authorization header: claims := parseJWT(r.Header.Get(&ldquo;Authorization&rdquo;)), userID := claims.Sub. (2) Use userID as rate limit key: rateLimiter.Allow(userID). (3) Fallback to IP for unauthenticated: clientID := userID; if clientID == "" { clientID = getClientIP(r) }. (4) Different limits per tier: premium users 1000 req/min, free users 100 req/min. Store limits in config/database keyed by user tier. Code pattern: type RateLimitConfig struct { Free: int; Premium: int }; limit := config.Free; if user.Tier == &ldquo;premium&rdquo; { limit = config.Premium }; limiter := rate.NewLimiter(rate.Limit(limit), burst). Challenges: (1) Anonymous users&ndash;still need IP-based limit for unauthenticated endpoints. (2) Token refresh&ndash;don&rsquo;t count auth endpoints against user limit (separate bucket). (3) Shared accounts&ndash;team API key, limit per key not per user. Advanced: hierarchical limits&ndash;100 req/s per user, 10k req/s per organization. Use Redis hash: key &lsquo;org:123:user:456&rsquo; tracks user, &lsquo;org:123&rsquo; tracks org total. Check both, reject if either exceeds.</div></div></details></li><li class="faq-item border-b border-gray-200 dark:border-gray-700" itemscope itemprop=mainEntity itemtype=https://schema.org/Question><details class=faq-details><summary class="cursor-pointer list-none py-5 md:py-6 flex items-start justify-between gap-6 select-none focus:outline-none hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors duration-150" itemprop=name><h3 class="font-semibold text-base md:text-lg text-gray-900 dark:text-white leading-[1.6] m-0 flex-1">What's the best way to handle WebSocket connections through API Gateway?</h3><span class="faq-arrow flex-shrink-0 mt-1"><svg class="w-5 h-5 text-gray-600 dark:text-gray-400 transition-transform duration-200 ease-in-out" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg></span></summary><div class="pb-6 pt-2" itemscope itemprop=acceptedAnswer itemtype=https://schema.org/Answer><div class="text-gray-700 dark:text-gray-300 leading-[1.7] text-[15px] md:text-base prose prose-gray dark:prose-invert max-w-none prose-p:my-2.5 prose-p:leading-[1.7] prose-code:bg-gray-100 dark:prose-code:bg-gray-700 prose-code:px-2 prose-code:py-1 prose-code:rounded prose-code:text-sm prose-code:font-mono" itemprop=text>Use httputil.ReverseProxy with custom Director for WebSocket upgrade. Standard reverse proxy works but needs WebSocket awareness: (1) Preserve Upgrade headers: proxy.Director = func(req *http.Request) { req.Header.Set(&ldquo;Upgrade&rdquo;, &ldquo;websocket&rdquo;); req.Header.Set(&ldquo;Connection&rdquo;, &ldquo;Upgrade&rdquo;) }. (2) Disable buffering: proxy.FlushInterval = -1 (required for streaming). (3) Long timeouts: ReadHeaderTimeout = 0 or very high (websockets stay open for hours). (4) Sticky sessions&ndash;same user always hits same backend: use consistent hashing based on user ID/session cookie. Round robin breaks stateful websockets. Implementation: detect websocket: if r.Header.Get(&ldquo;Upgrade&rdquo;) == &ldquo;websocket&rdquo; { useConsistentHashing() } else { useRoundRobin() }. Challenges: (1) Rate limiting websockets&ndash;limit connection attempts, not messages (hard to count without parsing). (2) Connection draining&ndash;when removing backend, allow existing websockets to finish (grace period). (3) Scaling&ndash;websockets tie connections to specific backends, harder to load balance. Consider: dedicated websocket gateway vs HTTP gateway, or use sticky sessions with session affinity cookies. Production: AWS ALB/NLB handle websockets better than custom gateway for high scale.</div></div></details></li></ul></div></div><script type=application/ld+json>
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    
    
    {
      "@type": "Question",
      "name": "\"What's the difference between Round Robin and Weighted Round Robin load balancing?\"",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "\"Round Robin distributes requests equally--each backend gets same number of requests in rotation: Backend1 -\\u003e Backend2 -\\u003e Backend3 -\\u003e repeat. Simple, fair for identical backends. Weighted Round Robin assigns different traffic proportions based on backend capacity--powerful server gets weight 3, weaker gets weight 1, so powerful server handles 3× traffic. Use Round Robin when: all backends identical specs, simple setup needed. Use Weighted when: mixed server specs (8-core and 4-core instances), gradual migration (new version weight 1, old version weight 9 during canary deploy), premium/economy tiers. Algorithm: Weighted tracks current weights, increments by backend's weight each round, selects highest, then subtracts total weight from selected. Ensures proportional distribution over time. Production: most start with Round Robin, switch to Weighted when adding heterogeneous backends or doing canary releases.\""
      }
    }
    
    ,
    {
      "@type": "Question",
      "name": "\"Should I use in-memory or Redis-based rate limiting for production?\"",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "\"Use Redis for distributed systems (multiple gateway instances), in-memory for single instance. In-memory rate limiting: (1) Faster--no network latency, ~1μs decision. (2) Simple--no external dependency. (3) Per-instance--if 3 gateways, each allows 100 req/s = 300 total. (4) Lost on restart--limits reset. Use when: single gateway, low traffic, development. Redis rate limiting: (1) Centralized--all gateways share limits, 100 req/s total across all instances. (2) Persistent--survives gateway restarts. (3) Slower--network round trip adds ~1-5ms. (4) Scales horizontally. Use when: multiple gateways, need exact limits, high availability. Hybrid approach: in-memory for first-pass (fast rejection), Redis for accurate tracking (check only if in-memory allows). Implementation: use golang.org/x/time/rate for in-memory, sorted sets in Redis for sliding window. Production: start in-memory for speed, add Redis when scaling to multiple instances.\""
      }
    }
    
    ,
    {
      "@type": "Question",
      "name": "\"How do I handle backend health checks without overloading backends?\"",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "\"Passive health checks + adaptive active checks. Passive: track request failures--if backend returns 3 consecutive 5xx errors, mark unhealthy, retry after cooldown. No extra load, reacts to real traffic. Active: periodic health endpoint checks--but smart intervals: (1) Start with 30s for healthy backends. (2) Increase to 10s if one 5xx seen (warning state). (3) Check every 5s when marked unhealthy (trying to recover). (4) Return to 30s after 3 successful checks. Avoid: checking every 1s--10 backends = 10 req/s just for health, wastes resources. Health endpoint: lightweight /health that checks: (1) Can connect to database (connection pool check, not query). (2) Disk not full. (3) Memory available. Don't: run expensive queries, external API calls. Circuit breaker pattern: after 5 consecutive failures, open circuit (stop sending traffic), half-open after 30s (send 1 test request), close if succeeds. Code: track lastHealthCheck timestamp, adjust interval based on state. This balances quick failure detection with minimal overhead.\""
      }
    }
    
    ,
    {
      "@type": "Question",
      "name": "\"Why does my API Gateway run out of file descriptors in production?\"",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "\"File descriptor exhaustion happens when gateway opens more connections than OS limit. Each backend connection + client connection uses FD. Default limit often 1024, production needs 10k-100k. Causes: (1) No connection reuse--creating new HTTP client per request instead of shared client with connection pool. (2) No timeouts--hung connections never close. (3) Too many backends--100 backends × 100 idle conns = 10k FDs. (4) Leaking connections--not closing response bodies: resp.Body.Close(). Fixes: (1) Shared HTTP client: var client = \\u0026http.Client{Transport: \\u0026http.Transport{MaxIdleConns: 100, MaxIdleConnsPerHost: 10}}. (2) Set timeouts: ReadTimeout, WriteTimeout on http.Server. (3) OS limits: ulimit -n 65535, or systemd LimitNOFILE=65535. (4) Close bodies: defer resp.Body.Close() after every request. (5) Monitor: track open FDs with lsof -p | wc -l. (6) Connection pooling: reuse connections via keep-alive. Production tuning: start with MaxIdleConnsPerHost=50, adjust based on load testing. Each backend connection stays open ~90s by default, plan accordingly.\""
      }
    }
    
    ,
    {
      "@type": "Question",
      "name": "\"How do I implement per-user rate limiting instead of per-IP?\"",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "\"Extract user ID from authentication token instead of IP address. Implementation: (1) Parse JWT/API key from Authorization header: claims := parseJWT(r.Header.Get(\\\"Authorization\\\")), userID := claims.Sub. (2) Use userID as rate limit key: rateLimiter.Allow(userID). (3) Fallback to IP for unauthenticated: clientID := userID; if clientID == \\\"\\\" { clientID = getClientIP(r) }. (4) Different limits per tier: premium users 1000 req/min, free users 100 req/min. Store limits in config/database keyed by user tier. Code pattern: type RateLimitConfig struct { Free: int; Premium: int }; limit := config.Free; if user.Tier == \\\"premium\\\" { limit = config.Premium }; limiter := rate.NewLimiter(rate.Limit(limit), burst). Challenges: (1) Anonymous users--still need IP-based limit for unauthenticated endpoints. (2) Token refresh--don't count auth endpoints against user limit (separate bucket). (3) Shared accounts--team API key, limit per key not per user. Advanced: hierarchical limits--100 req/s per user, 10k req/s per organization. Use Redis hash: key 'org:123:user:456' tracks user, 'org:123' tracks org total. Check both, reject if either exceeds.\""
      }
    }
    
    ,
    {
      "@type": "Question",
      "name": "\"What's the best way to handle WebSocket connections through API Gateway?\"",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "\"Use httputil.ReverseProxy with custom Director for WebSocket upgrade. Standard reverse proxy works but needs WebSocket awareness: (1) Preserve Upgrade headers: proxy.Director = func(req *http.Request) { req.Header.Set(\\\"Upgrade\\\", \\\"websocket\\\"); req.Header.Set(\\\"Connection\\\", \\\"Upgrade\\\") }. (2) Disable buffering: proxy.FlushInterval = -1 (required for streaming). (3) Long timeouts: ReadHeaderTimeout = 0 or very high (websockets stay open for hours). (4) Sticky sessions--same user always hits same backend: use consistent hashing based on user ID/session cookie. Round robin breaks stateful websockets. Implementation: detect websocket: if r.Header.Get(\\\"Upgrade\\\") == \\\"websocket\\\" { useConsistentHashing() } else { useRoundRobin() }. Challenges: (1) Rate limiting websockets--limit connection attempts, not messages (hard to count without parsing). (2) Connection draining--when removing backend, allow existing websockets to finish (grace period). (3) Scaling--websockets tie connections to specific backends, harder to load balance. Consider: dedicated websocket gateway vs HTTP gateway, or use sticky sessions with session affinity cookies. Production: AWS ALB/NLB handle websockets better than custom gateway for high scale.\""
      }
    }
    
  ]
}
</script><style>details.faq-details[open] .faq-arrow svg{transform:rotate(180deg)}</style><script>document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll(".faq-item");e.forEach(function(t){t.addEventListener("toggle",function(){this.open&&e.forEach(function(e){e!==t&&e.open&&(e.open=!1)})})})})</script></article><aside class="space-y-10 hidden lg:block"><div><h3 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">Popular Posts</h3><ul class="space-y-3 list-disc list-outside pl-5 text-sm text-gray-800 dark:text-gray-200"><li><a href=/2025/11/developer-roadmap-2025-skills-you-need-to-get-hired.html class="hover:text-[#0f7ea9] transition">Developer Roadmap 2025: Skills You Need to Get Hired</a></li><li><a href=/2025/11/best-programming-language-to-learn-in-2025-for-beginners.html class="hover:text-[#0f7ea9] transition">Best Programming Language to Learn in 2025 for Beginners</a></li><li><a href=/2025/11/how-to-implement-passkey-authentication-go-webauthn.html class="hover:text-[#0f7ea9] transition">How to Implement Passkey Authentication with Go - WebAuthn Tutorial</a></li><li><a href=/2025/10/how-to-build-rest-api-django-rest-framework-production-ready.html class="hover:text-[#0f7ea9] transition">How to Build a REST API with Django REST Framework (Production Ready)</a></li><li><a href=/2025/10/python-automation-scripts-every-developer-should-know.html class="hover:text-[#0f7ea9] transition">Python Automation Scripts Every Developer Should Know (Save Hours Weekly)</a></li></ul></div></aside></div><section id=comments class=mt-12><script src=https://giscus.app/client.js data-repo=wikukarno/buanacoding data-repo-id=R_kgD0Oj4jAw data-category=General data-category-id=DIC_kwD0Oj4jA84Cr_fx data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></section></div></main><div class=py-6><div class="max-w-7xl mx-auto px-4"><div class="text-center mb-3"><span class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-medium">Advertisement</span></div><div class="flex justify-center"><ins class="adsbygoogle lazy-ad" style=display:block;min-height:90px;max-width:100% data-ad-client=ca-pub-3149036684216973 data-ad-slot=3879195288 data-ad-format=auto data-full-width-responsive=true></ins></div></div></div><div class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-white py-4 transition-colors duration-300"><div class="text-center space-x-4 text-sm font-medium"><a href=/about class="hover:text-cyan-500 dark:hover:text-cyan-400">About</a>
<span>-</span>
<a href=/contact class="hover:text-cyan-500 dark:hover:text-cyan-400">Contact</a>
<span>-</span>
<a href=/privacy-policy class="hover:text-cyan-500 dark:hover:text-cyan-400">Privacy Policy</a>
<span>-</span>
<a href=/disclaimer class="hover:text-cyan-500 dark:hover:text-cyan-400">Disclaimer</a></div></div><footer class="text-center text-sm text-gray-500 dark:text-gray-400 py-4 border-t border-gray-200 dark:border-gray-700">&copy; 2026 buanacoding.com</footer><button id=scrollToTop class="fixed bottom-6 right-6 lg:bottom-6 lg:right-6 bg-[#0f7ea9] hover:bg-cyan-600 text-white p-3 rounded-full shadow transition duration-300 z-50" aria-label="Scroll to top">
<svg fill="none" class="w-4 h-4" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/></svg></button><style>body.floating-ad-active #scrollToTop{bottom:100px!important}@media(min-width:1024px){body.floating-ad-active #scrollToTop{bottom:1.5rem!important}}</style><div id=google_translate_element style=display:none></div><script src=https://unpkg.com/feather-icons defer onload=feather.replace()></script><script>(function(){function e(t,n){if(typeof window.adsbygoogle=="undefined"||!window.adsbygoogle.loaded){setTimeout(function(){e(t,n)},100);return}if(t.offsetWidth>0&&!t.dataset.adPushed){try{t.dataset.adPushed="true",(adsbygoogle=window.adsbygoogle||[]).push({})}catch(e){console.log("AdSense push error:",e)}n&&n.unobserve(t)}}function t(){var n,t=document.querySelectorAll(".lazy-ad:not([data-ad-pushed])");if(!t.length)return;"IntersectionObserver"in window?(n=new IntersectionObserver(function(t){t.forEach(function(t){t.isIntersecting&&e(t.target,n)})},{rootMargin:"200px 0px",threshold:0}),t.forEach(function(e){n.observe(e)})):t.forEach(function(t){e(t,null)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t()})();const btn=document.getElementById("scrollToTop"),html=document.documentElement,toggleBtn=document.getElementById("theme-toggle"),toggleBtnMobile=document.getElementById("theme-toggle-mobile"),iconSun=document.getElementById("icon-sun"),iconMoon=document.getElementById("icon-moon"),iconSunMobile=document.getElementById("icon-sun-mobile"),iconMoonMobile=document.getElementById("icon-moon-mobile");document.getElementById("menu-toggle")?.addEventListener("click",()=>{document.getElementById("mobile-menu")?.classList.toggle("hidden")}),btn.style.display="none",window.addEventListener("scroll",()=>{window.scrollY>300?btn.style.display="flex":btn.style.display="none"}),btn.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})});function updateIcons(e){iconSun.classList.toggle("hidden",!e),iconMoon.classList.toggle("hidden",e),iconSunMobile.classList.toggle("hidden",!e),iconMoonMobile.classList.toggle("hidden",e)}function setDarkMode(e){html.setAttribute("data-theme",e?"dark":"light"),localStorage.setItem("theme",e?"dark":"light"),updateIcons(e)}const userPref=localStorage.getItem("theme"),systemPref=window.matchMedia("(prefers-color-scheme: dark)").matches,isDark=userPref==="dark"||!userPref&&systemPref;setDarkMode(isDark),toggleBtn?.addEventListener("click",()=>{const e=html.getAttribute("data-theme")==="dark";setDarkMode(!e)}),toggleBtnMobile?.addEventListener("click",()=>{const e=html.getAttribute("data-theme")==="dark";setDarkMode(!e)}),document.querySelectorAll("pre").forEach(e=>{const t=document.createElement("button");t.innerHTML=`
      <span>Copy</span>
    `,t.className=`
    copy-btn absolute top-2 right-2
    text-xs px-2 py-1 rounded flex items-center gap-1
    transition-colors duration-200
    bg-gray-200 text-gray-800 hover:bg-gray-300
    dark:bg-white/10 dark:text-white dark:hover:bg-white/20
  `.trim();const n=document.createElement("div");n.className="relative",e.parentNode.insertBefore(n,e),n.appendChild(e),n.appendChild(t),t.addEventListener("click",()=>{const n=e.innerText;navigator.clipboard.writeText(n).then(()=>{t.querySelector("span").innerText="Copied!",setTimeout(()=>{t.querySelector("span").innerText="Copy"},2e3)})})});const openBtn=document.getElementById("openSearchModal"),closeBtn=document.getElementById("closeSearchModal"),modal=document.getElementById("searchModal");let searchInitialized=!1,fuse=null;function initSearch(){return searchInitialized?Promise.resolve():new Promise(e=>{const t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6",t.onload=()=>{fetch("/index.json").then(e=>e.json()).then(t=>{fuse=new Fuse(t,{keys:["title","summary"],threshold:.3}),searchInitialized=!0,setupSearchHandler(),e()})},document.head.appendChild(t)})}function setupSearchHandler(){const t=document.getElementById("searchBox"),e=document.getElementById("results");t.addEventListener("input",function(t){const s=t.target.value.trim(),n=document.getElementById("searchAdBanner");if(s.length<2){e.innerHTML="",n&&(n.classList.remove("show"),n.classList.add("hide"),setTimeout(()=>n.style.display="none",300));return}n&&(n.style.display="block",n.classList.remove("hide"),n.classList.add("show"));const o=fuse.search(s);if(o.length===0)e.innerHTML=`
          <li class='px-4 py-3 text-center text-gray-500 dark:text-gray-400'>
            <div class="mb-2">📄 No results found for "${s}"</div>
            <div class="text-xs">Try different keywords or browse categories below</div>
          </li>
        `;else{let t="";o.forEach((e,n)=>{t+=`
            <li class="px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <a href="${e.item.href}" class="block font-semibold text-gray-900 dark:text-white no-underline">${e.item.title}</a>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">${e.item.summary}</p>
            </li>
          `,(n+1)%3===0&&n<o.length-1&&(t+=`
              <li class="px-4 py-2 bg-blue-50 dark:bg-gray-800 border-l-4 border-blue-400">
                <div class="text-xs text-blue-600 dark:text-blue-400 font-medium">📚 More related articles</div>
              </li>
            `)}),e.innerHTML=t}})}openBtn.addEventListener("click",()=>{modal.classList.remove("hidden"),initSearch().then(()=>{document.getElementById("searchBox").focus()})}),closeBtn.addEventListener("click",()=>{modal.classList.add("hidden")}),document.addEventListener("keydown",e=>{e.key==="Escape"&&modal.classList.add("hidden")});const openBtnMobile=document.getElementById("openSearchModalMobile");openBtnMobile.addEventListener("click",()=>{modal.classList.remove("hidden"),initSearch().then(()=>{document.getElementById("searchBox").focus()})}),function(){function t(e,t){if(window.google&&window.google.translate&&window.google.translate.TranslateElement){e&&e();return}if(window.__gtReadyCallbacks=window.__gtReadyCallbacks||[],e&&window.__gtReadyCallbacks.push(e),window.__gtLoading)return;window.__gtLoading=!0,window.initGoogleTranslate=function(){try{new window.google.translate.TranslateElement({pageLanguage:"en",includedLanguages:"id",autoDisplay:!1},"google_translate_element")}catch{}(window.__gtReadyCallbacks||[]).forEach(function(e){try{e()}catch{}}),window.__gtReadyCallbacks=[]};var s,n=document.createElement("script");n.src="https://translate.google.com/translate_a/element.js?cb=initGoogleTranslate",n.defer=!0,s=!1,n.onerror=function(){s=!0,t&&t()},setTimeout(function(){(!window.google||!window.google.translate)&&(s=!0,t&&t())},4e3),document.head.appendChild(n)}function n(e,t){document.cookie=e+"="+t+"; path=/; expires="+new Date(Date.now()+365*24*3600*1e3).toUTCString()}function e(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/"}function s(){if(document.getElementById("translate-fallback"))return;var e=document.createElement("div");e.id="translate-fallback",e.style.cssText="position:fixed;bottom:12px;left:50%;transform:translateX(-50%);z-index:9999;background:#111827;color:#fff;padding:10px 14px;border-radius:10px;box-shadow:0 4px 16px rgba(0,0,0,0.25);display:flex;gap:10px;align-items:center;",e.innerHTML='<span style="font-size:13px">Auto-translate tidak tersedia di perangkat ini.</span><button id="btnTryId" style="background:#0ea5e9;color:#fff;border:none;padding:6px 10px;border-radius:8px;font-size:12px">Coba versi Indonesia</button><button id="btnCloseTf" style="background:transparent;color:#fff;border:1px solid #fff3;padding:6px 10px;border-radius:8px;font-size:12px">Tutup</button>',document.body.appendChild(e),document.getElementById("btnCloseTf").onclick=function(){e.remove()},document.getElementById("btnTryId").onclick=function(){var t=new URL(location.href),e=location.pathname;e.startsWith("/id/")||(t.pathname="/id"+(e.startsWith("/")?e:"/"+e)),fetch(t,{method:"HEAD"}).then(function(e){e.ok?location.href=t:location.href="/id/"}).catch(function(){location.href="/id/"})}}function o(e){t(function(){var t=document.querySelector(".goog-te-combo");t?(t.value=e,t.dispatchEvent(new Event("change"))):(n("googtrans","/en/"+e),location.reload())},s)}function i(){e("googtrans"),e("GOOGTRANS")}document.querySelectorAll(".js-lang-link").forEach(function(e){e.addEventListener("click",function(t){var n=e.getAttribute("data-lang"),s=e.getAttribute("data-has-trans")==="true";if(n==="en"){i();return}s||(t.preventDefault(),o(n))})})}()</script></body></html>