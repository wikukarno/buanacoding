<!doctype html><html lang=en data-theme=light><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>FastAPI JWT Auth with OAuth2 Password Flow (Pydantic v2 + SQLAlchemy 2.0) | Buana Coding</title><meta name=description content="A pragmatic guide to building username/password login in FastAPI using OAuth2 Password flow with JWTs, powered by Pydantic v2 and SQLAlchemy 2.0. Includes hashing, token creation, protected routes, and testing."><meta name=keywords content="fastapi,jwt,oauth2 password flow,pydantic v2,sqlalchemy 2,python,auth,password hashing"><link rel=canonical href=https://www.buanacoding.com/2025/08/fastapi-jwt-auth-oauth2-password-flow-pydantic-v2-sqlalchemy-2.html><link rel=alternate hreflang=en href=https://www.buanacoding.com/2025/08/fastapi-jwt-auth-oauth2-password-flow-pydantic-v2-sqlalchemy-2.html><meta property="og:type" content="article"><meta property="og:title" content="FastAPI JWT Auth with OAuth2 Password Flow (Pydantic v2 + SQLAlchemy 2.0) | Buana Coding"><meta property="og:description" content="A pragmatic guide to building username/password login in FastAPI using OAuth2 Password flow with JWTs, powered by Pydantic v2 and SQLAlchemy 2.0. Includes hashing, token creation, protected routes, and testing."><meta property="og:url" content="https://www.buanacoding.com/2025/08/fastapi-jwt-auth-oauth2-password-flow-pydantic-v2-sqlalchemy-2.html"><meta property="og:image" content="https://www.buanacoding.com/images/og-image.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="FastAPI JWT Auth with OAuth2 Password Flow (Pydantic v2 + SQLAlchemy 2.0) | Buana Coding"><meta name=twitter:description content="A pragmatic guide to building username/password login in FastAPI using OAuth2 Password flow with JWTs, powered by Pydantic v2 and SQLAlchemy 2.0. Includes hashing, token creation, protected routes, and testing."><meta name=twitter:image content="https://www.buanacoding.com/images/og-image.jpg"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"FastAPI JWT Auth with OAuth2 Password Flow (Pydantic v2 \u002b SQLAlchemy 2.0) | Buana Coding","description":"A pragmatic guide to building username\/password login in FastAPI using OAuth2 Password flow with JWTs, powered by Pydantic v2 and SQLAlchemy 2.0. Includes hashing, token creation, protected routes, and testing.","inLanguage":"en","datePublished":"2025-08-20T07:00:00\u002b07:00","dateModified":"2025-08-20T07:00:00\u002b07:00","author":{"@type":"Person","name":"Wiku Karno"},"mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.buanacoding.com\/2025\/08\/fastapi-jwt-auth-oauth2-password-flow-pydantic-v2-sqlalchemy-2.html"},"image":"https:\/\/www.buanacoding.com\/images\/og-image.jpg","publisher":{"@type":"Organization","name":"Buana Coding"}}</script><link rel=icon href=/favicon.ico type=image/x-icon><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel=stylesheet><link rel=stylesheet href="/style.css?v=1755934679"><link rel=stylesheet href="/css/overrides.css?v=1755934679"><link rel=stylesheet href="/css/syntax.css?v=1755934679"><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("consent","default",{ad_storage:"granted",ad_user_data:"granted",ad_personalization:"granted",analytics_storage:"granted"})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-0EN9J73FXF"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0EN9J73FXF")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3149036684216973" crossorigin=anonymous></script></head><body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen flex flex-col"><header class="bg-[#0f7ea9] dark:bg-[#094d66] text-white shadow"><div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center"><h1 class="text-2xl font-extrabold tracking-wide"><a href=/ class=hover:opacity-90>BUANACODING</a></h1><nav class="hidden md:flex items-center space-x-6 font-semibold uppercase tracking-wide"><a href=/tags/go class="no-underline hover:text-cyan-300 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize">Go
</a><a href=/tags/laravel class="no-underline hover:text-cyan-300 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize">Laravel
</a><a href=/tags/linux class="no-underline hover:text-cyan-300 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize">Linux
</a><a href=/tags/python class="no-underline hover:text-cyan-300 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize">Python
</a><a href=/tags/security class="no-underline hover:text-cyan-300 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize">Security</a><div class="hidden md:flex items-center"><div class="flex border border-white/30 rounded overflow-hidden text-xs font-medium"><a href=/2025/08/fastapi-jwt-auth-oauth2-password-flow-pydantic-v2-sqlalchemy-2.html data-lang=en data-has-trans=true class="js-lang-link px-2 py-1 bg-white/20 text-white">EN
</a><a href=/id/ data-lang=id data-has-trans=false class="js-lang-link px-2 py-1 bg-transparent hover:bg-white/10 text-white/80">ID</a></div></div><button id=openSearchModal class="text-white transition duration-300 cursor-pointer focus:outline-none dark:hover:text-[#0f7ea9] hover:text-cyan-300" aria-label=Search>
<i data-feather=search class="w-5 h-5"></i>
</button>
<button id=theme-toggle class="ml-2 text-white hover:text-yellow-300 transition duration-300 focus:outline-none cursor-pointer" aria-label="Toggle Dark Mode">
<i id=icon-sun data-feather=sun class="w-5 h-5 hidden"></i>
<i id=icon-moon data-feather=moon class="w-5 h-5"></i></button></nav><button id=menu-toggle class="md:hidden text-2xl focus:outline-none">
☰</button></div><div id=mobile-menu class="hidden md:hidden px-4 pb-4 space-y-2"><a href=/tags/go class="block no-underline hover:text-cyan-500 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize">Go
</a><a href=/tags/laravel class="block no-underline hover:text-cyan-500 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize">Laravel
</a><a href=/tags/linux class="block no-underline hover:text-cyan-500 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize">Linux
</a><a href=/tags/python class="block no-underline hover:text-cyan-500 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize">Python
</a><a href=/tags/security class="block no-underline hover:text-cyan-500 dark:hover:text-[#0f7ea9] transition font-medium text-sm capitalize">Security</a><div class="flex flex-col items-start gap-4 mt-2"><div class="flex items-center gap-3"><span class="text-xs opacity-80">English</span>
<a href=/ class="text-white hover:text-[#0f7ea9] text-sm">English</a>
<a href=/id/ class="text-white hover:text-[#0f7ea9] text-sm">Indonesia</a></div><button id=openSearchModalMobile class="text-white hover:text-[#0f7ea9] transition duration-300" aria-label=Search>
<i data-feather=search class="w-5 h-5"></i></button><div class="flex items-center"><div class="flex border border-white/30 rounded overflow-hidden text-xs font-medium"><a href=/2025/08/fastapi-jwt-auth-oauth2-password-flow-pydantic-v2-sqlalchemy-2.html data-lang=en data-has-trans=true class="js-lang-link px-2 py-1 bg-white/20 text-white">EN
</a><a href=/id/ data-lang=id data-has-trans=false class="js-lang-link px-2 py-1 bg-transparent hover:bg-white/10 text-white/80">ID</a></div></div><button id=theme-toggle-mobile class="text-white hover:text-[#0f7ea9] transition duration-300" aria-label="Toggle Dark Mode">
<i id=icon-sun-mobile data-feather=sun class="w-5 h-5 hidden"></i>
<i id=icon-moon-mobile data-feather=moon class="w-5 h-5"></i></button></div></div></header><div id=searchModal class="fixed inset-0 z-50 hidden flex justify-center items-center bg-black/30 dark:bg-black/60 backdrop-blur-md p-4"><div class="bg-white dark:bg-[#1f2937] rounded-xl shadow-2xl w-full max-w-xl p-6 relative"><button id=closeSearchModal class="absolute -top-4 -right-4 bg-white dark:bg-[#374151] rounded-full p-1 shadow hover:bg-gray-100 dark:hover:bg-gray-600 transition duration-200 ease-in-out transform hover:scale-110">
<i data-feather=x class="w-5 h-5 text-gray-600 dark:text-white hover:text-red-500"></i>
</button>
<input type=text id=searchBox placeholder="Search articles..." class="w-full px-4 py-3 mb-4 border border-cyan-400 text-gray-800 dark:text-white dark:bg-[#374151] placeholder-gray-400 dark:placeholder-gray-400 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500"><ul id=results class="bg-white dark:bg-[#1f2937] rounded-lg shadow max-h-60 overflow-y-auto divide-y divide-gray-200 dark:divide-gray-600"></ul></div></div><main class="flex-1 w-full"><div class="max-w-7xl mx-auto py-8 px-4"><div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8 py-8"><article class="prose prose-blue dark:prose-invert lg:col-span-2"><nav class="text-sm text-gray-500 dark:text-gray-400 mb-4"><a href=/ class="hover:text-[#0f7ea9] font-medium">Home</a>
<span class=mx-2>/</span>
<a href=/tags/python class="hover:text-[#0f7ea9] font-medium">#Python</a></nav><h1>FastAPI JWT Auth with OAuth2 Password Flow (Pydantic v2 + SQLAlchemy 2.0)</h1><div class="flex items-center gap-4 my-4 py-3 border-b border-gray-200 dark:border-gray-700"><span class="text-sm text-gray-500 dark:text-gray-400 font-medium mr-2">Share:</span>
<a href="https://twitter.com/intent/tweet?text=FastAPI+JWT+Auth+with+OAuth2+Password+Flow+%28Pydantic+v2+%2B+SQLAlchemy+2.0%29&url=https%3A%2F%2Fwww.buanacoding.com%2F2025%2F08%2Ffastapi-jwt-auth-oauth2-password-flow-pydantic-v2-sqlalchemy-2.html&via=buanacoding" target=_blank rel=noopener class="p-2 text-gray-500 dark:text-gray-400 hover:text-black hover:bg-gray-100 dark:hover:text-white dark:hover:bg-gray-700 rounded-full transition-all duration-200" title="Share on Twitter"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
</a><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.buanacoding.com%2F2025%2F08%2Ffastapi-jwt-auth-oauth2-password-flow-pydantic-v2-sqlalchemy-2.html" target=_blank rel=noopener class="p-2 text-gray-500 dark:text-gray-400 hover:text-blue-600 hover:bg-blue-50 dark:hover:text-blue-400 dark:hover:bg-blue-900/20 rounded-full transition-all duration-200" title="Share on Facebook"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312.0 2.686.235 2.686.235v2.953H15.83c-1.491.0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
</a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fwww.buanacoding.com%2F2025%2F08%2Ffastapi-jwt-auth-oauth2-password-flow-pydantic-v2-sqlalchemy-2.html" target=_blank rel=noopener class="p-2 text-gray-500 dark:text-gray-400 hover:text-blue-700 hover:bg-blue-50 dark:hover:text-blue-400 dark:hover:bg-blue-900/20 rounded-full transition-all duration-200" title="Share on LinkedIn"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853.0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601.0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144.0-2.063-.926-2.063-2.065.0-1.138.92-2.063 2.063-2.063 1.14.0 2.064.925 2.064 2.063.0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225.0H1.771C.792.0.0.774.0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2.0 22.222.0h.003z"/></svg>
</a><a href="https://wa.me/?text=FastAPI+JWT+Auth+with+OAuth2+Password+Flow+%28Pydantic+v2+%2B+SQLAlchemy+2.0%29%20https%3A%2F%2Fwww.buanacoding.com%2F2025%2F08%2Ffastapi-jwt-auth-oauth2-password-flow-pydantic-v2-sqlalchemy-2.html" target=_blank rel=noopener class="p-2 text-gray-500 dark:text-gray-400 hover:text-green-600 hover:bg-green-50 dark:hover:text-green-400 dark:hover:bg-green-900/20 rounded-full transition-all duration-200" title="Share on WhatsApp"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198.0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479.0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87.0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86.0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64.0 5.122 1.03 6.988 2.898a9.825 9.825.0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815.0 0012.05.0C5.495.0.16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882.0 005.683 1.448h.005c6.554.0 11.89-5.335 11.893-11.893A11.821 11.821.0 0020.484 3.488"/></svg>
</a><button onclick='copyLinkHeader("https://www.buanacoding.com/2025/08/fastapi-jwt-auth-oauth2-password-flow-pydantic-v2-sqlalchemy-2.html")' class="p-2 text-gray-500 dark:text-gray-400 hover:text-gray-800 hover:bg-gray-100 dark:hover:text-gray-200 dark:hover:bg-gray-700 rounded-full transition-all duration-200" title="Copy Link">
<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
</button>
<span id=copy-header-success class="hidden text-xs text-green-600 dark:text-green-400 font-medium">Copied!</span></div><script>function copyLinkHeader(e){navigator.clipboard.writeText(e).then(function(){showHeaderSuccess()}).catch(function(){const n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),showHeaderSuccess()})}function showHeaderSuccess(){const e=document.getElementById("copy-header-success");e.classList.remove("hidden"),setTimeout(function(){e.classList.add("hidden")},2e3)}</script><p>Looking to add login to your FastAPI app without pulling in a full auth service? Here’s a small, production‑friendly setup. We’ll build username/password authentication with the OAuth2 Password flow and JSON Web Tokens (JWTs) for stateless access. It uses Pydantic v2 for validation and SQLAlchemy 2.0 for persistence. You’ll hash passwords properly, create/verify tokens, protect routes, and test everything end‑to‑end.</p><p>If you’re deploying the finished app on Ubuntu with HTTPS, check the deployment guide: <a href=/2025/08/deploy-fastapi-ubuntu-24-04-gunicorn-nginx-certbot.html>Deploy FastAPI on Ubuntu 24.04: Gunicorn + Nginx + Certbot
</a>.</p><h2 id=what-youll-build>What you’ll build</h2><ul><li>A minimal user model backed by SQLAlchemy 2.0</li><li>Password hashing using <code>passlib[bcrypt]</code></li><li>JWT access token creation and verification with <code>python-jose</code></li><li>OAuth2 Password flow login endpoint (<code>/token</code>)</li><li>Protected routes using <code>OAuth2PasswordBearer</code></li><li>A simple current‑user dependency that decodes JWTs</li></ul><h2 id=prerequisites>Prerequisites</h2><ul><li>Python 3.10+</li><li>Basic FastAPI experience</li><li>SQLite for demo (swap with PostgreSQL/MySQL in production)</li></ul><ol><li>Best‑practice project structure</li></ol><hr><p>Use a small but clear layout so your imports stay tidy as the app grows:</p><div class="my-8 flex justify-center"><div class="w-full max-w-2xl"><div class="text-center mb-2"><span class="text-xs text-gray-400 dark:text-gray-500 uppercase tracking-wide font-medium">Advertisement</span></div><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-3149036684216973 data-ad-slot=2492895769></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div><pre tabindex=0><code>app/
  main.py
  core/
    security.py
  db/
    base.py
    session.py
  models/
    user.py
  schemas/
    user.py
  api/
    deps.py
    routes/
      auth.py
      users.py
      health.py
</code></pre><ol start=2><li>Install dependencies</li></ol><hr><p>Create and activate a virtual environment, then install dependencies:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 -m venv .venv
</span></span><span class=line><span class=cl><span class=nb>source</span> .venv/bin/activate
</span></span><span class=line><span class=cl>pip install --upgrade pip
</span></span><span class=line><span class=cl>pip install fastapi uvicorn sqlalchemy pydantic passlib<span class=o>[</span>bcrypt<span class=o>]</span> python-jose<span class=o>[</span>cryptography<span class=o>]</span> python-dotenv python-multipart
</span></span></code></pre></div><p>Optional but recommended: manage secrets via a <code>.env</code> file during development.</p><p>Create a <code>.env</code> file in your project root:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat &gt; .env <span class=s>&lt;&lt;&#39;ENV&#39;
</span></span></span><span class=line><span class=cl><span class=s>SECRET_KEY=$(openssl rand -hex 32)
</span></span></span><span class=line><span class=cl><span class=s>ACCESS_TOKEN_EXPIRE_MINUTES=30
</span></span></span><span class=line><span class=cl><span class=s>ENV</span>
</span></span></code></pre></div><h2 id=where-should-env-live>Where should <code>.env</code> live?</h2><ul><li>Put <code>.env</code> in the project root (same level as <code>app/</code>).</li><li>Run the app from the root so <code>load_dotenv()</code> finds it:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>uvicorn app.main:app --reload --host 0.0.0.0 --port <span class=m>8000</span>
</span></span></code></pre></div><ul><li>Add <code>.env</code> to <code>.gitignore</code> so it doesn’t get committed:</li></ul><pre tabindex=0><code class=language-gitignore data-lang=gitignore>.env
</code></pre><p>If you sometimes run the app from a different working directory, you can load <code>.env</code> with an explicit path:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># app/core/security.py (alternative)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pathlib</span> <span class=kn>import</span> <span class=n>Path</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dotenv</span> <span class=kn>import</span> <span class=n>load_dotenv</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>load_dotenv</span><span class=p>(</span><span class=n>Path</span><span class=p>(</span><span class=vm>__file__</span><span class=p>)</span><span class=o>.</span><span class=n>resolve</span><span class=p>()</span><span class=o>.</span><span class=n>parents</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>/</span> <span class=s2>&#34;.env&#34;</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=envexample-and-requirementstxt-placement><code>.env.example</code> and <code>requirements.txt</code> placement</h2><p>Keep both files at the project root for clarity and portability:</p><pre tabindex=0><code>.
├─ .env                # not committed
├─ .env.example        # committed, template for teammates/CI
├─ requirements.txt    # pinned or curated dependencies
└─ app/
   ├─ core/
   ├─ db/
   ├─ models/
   ├─ schemas/
   ├─ api/
   └─ main.py
</code></pre><p>Suggested <code>.env.example</code>:</p><pre tabindex=0><code class=language-dotenv data-lang=dotenv># .env.example
# Copy this file to .env and change the values as needed.
SECRET_KEY=change-me-to-a-strong-random-value
ACCESS_TOKEN_EXPIRE_MINUTES=30
# DATABASE_URL is optional here because the demo uses SQLite via app/db/session.py
# For Postgres, uncomment and use your DSN:
# DATABASE_URL=postgresql+psycopg://user:password@localhost:5432/mydb
</code></pre><p>Pin dependencies with a <code>requirements.txt</code> (recommended):</p><p>Option A — write a curated <code>requirements.txt</code> with compatible ranges:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>fastapi&gt;=0.110,&lt;1
</span></span><span class=line><span class=cl>uvicorn[standard]&gt;=0.29,&lt;1
</span></span><span class=line><span class=cl>sqlalchemy&gt;=2.0,&lt;3
</span></span><span class=line><span class=cl>pydantic&gt;=2.5,&lt;3
</span></span><span class=line><span class=cl>passlib[bcrypt]&gt;=1.7,&lt;2
</span></span><span class=line><span class=cl>python-jose[cryptography]&gt;=3.3,&lt;4
</span></span><span class=line><span class=cl>python-dotenv&gt;=1.0,&lt;2
</span></span><span class=line><span class=cl>python-multipart&gt;=0.0.9,&lt;1
</span></span></code></pre></div><p>Option B — pin exact versions from your current env:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pip freeze &gt; requirements.txt
</span></span></code></pre></div><p>Later, reproduce the env with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 -m venv .venv
</span></span><span class=line><span class=cl><span class=nb>source</span> .venv/bin/activate
</span></span><span class=line><span class=cl>pip install -r requirements.txt
</span></span></code></pre></div><ol start=3><li>Database setup (SQLAlchemy 2.0)</li></ol><hr><p>Create two files for database plumbing.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># app/db/base.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.orm</span> <span class=kn>import</span> <span class=n>DeclarativeBase</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Base</span><span class=p>(</span><span class=n>DeclarativeBase</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># app/db/session.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy</span> <span class=kn>import</span> <span class=n>create_engine</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.orm</span> <span class=kn>import</span> <span class=n>sessionmaker</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>SQLALCHEMY_DATABASE_URL</span> <span class=o>=</span> <span class=s2>&#34;sqlite:///./app.db&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>engine</span> <span class=o>=</span> <span class=n>create_engine</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>SQLALCHEMY_DATABASE_URL</span><span class=p>,</span> <span class=n>connect_args</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;check_same_thread&#34;</span><span class=p>:</span> <span class=kc>False</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>SessionLocal</span> <span class=o>=</span> <span class=n>sessionmaker</span><span class=p>(</span><span class=n>autocommit</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>autoflush</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>bind</span><span class=o>=</span><span class=n>engine</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_db</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span> <span class=o>=</span> <span class=n>SessionLocal</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>yield</span> <span class=n>db</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>db</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></div><ol start=4><li>Models and schemas</li></ol><hr><p>We’ll store users with <code>username</code> and a hashed password (never store plain passwords).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># app/models/user.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy</span> <span class=kn>import</span> <span class=n>Integer</span><span class=p>,</span> <span class=n>String</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.orm</span> <span class=kn>import</span> <span class=n>Mapped</span><span class=p>,</span> <span class=n>mapped_column</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app.db.base</span> <span class=kn>import</span> <span class=n>Base</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>User</span><span class=p>(</span><span class=n>Base</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>__tablename__</span> <span class=o>=</span> <span class=s2>&#34;users&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>id</span><span class=p>:</span> <span class=n>Mapped</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>mapped_column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>username</span><span class=p>:</span> <span class=n>Mapped</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>mapped_column</span><span class=p>(</span><span class=n>String</span><span class=p>,</span> <span class=n>unique</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>hashed_password</span><span class=p>:</span> <span class=n>Mapped</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>mapped_column</span><span class=p>(</span><span class=n>String</span><span class=p>)</span>
</span></span></code></pre></div><p>Pydantic v2 schemas for reading/creating users:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># app/schemas/user.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pydantic</span> <span class=kn>import</span> <span class=n>BaseModel</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserCreate</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>username</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>password</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserRead</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>id</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>username</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>model_config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;from_attributes&#34;</span><span class=p>:</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Token</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>access_token</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>token_type</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;bearer&#34;</span>
</span></span></code></pre></div><ol start=5><li>Security helpers: hashing and JWT</li></ol><hr><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># app/core/security.py</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>timedelta</span><span class=p>,</span> <span class=n>timezone</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>jose</span> <span class=kn>import</span> <span class=n>jwt</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>passlib.context</span> <span class=kn>import</span> <span class=n>CryptContext</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dotenv</span> <span class=kn>import</span> <span class=n>load_dotenv</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>load_dotenv</span><span class=p>()</span>  <span class=c1># load variables from .env if present</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pwd_context</span> <span class=o>=</span> <span class=n>CryptContext</span><span class=p>(</span><span class=n>schemes</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;bcrypt&#34;</span><span class=p>],</span> <span class=n>deprecated</span><span class=o>=</span><span class=s2>&#34;auto&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>SECRET_KEY</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;SECRET_KEY&#34;</span><span class=p>,</span> <span class=s2>&#34;change-this-in-env&#34;</span><span class=p>)</span>  <span class=c1># override in production</span>
</span></span><span class=line><span class=cl><span class=n>ALGORITHM</span> <span class=o>=</span> <span class=s2>&#34;HS256&#34;</span>
</span></span><span class=line><span class=cl><span class=n>ACCESS_TOKEN_EXPIRE_MINUTES</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;ACCESS_TOKEN_EXPIRE_MINUTES&#34;</span><span class=p>,</span> <span class=s2>&#34;30&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>verify_password</span><span class=p>(</span><span class=n>plain_password</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>hashed_password</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>pwd_context</span><span class=o>.</span><span class=n>verify</span><span class=p>(</span><span class=n>plain_password</span><span class=p>,</span> <span class=n>hashed_password</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>hash_password</span><span class=p>(</span><span class=n>password</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>pwd_context</span><span class=o>.</span><span class=n>hash</span><span class=p>(</span><span class=n>password</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_access_token</span><span class=p>(</span><span class=n>subject</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>expires_delta</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>timedelta</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>expire</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(</span><span class=n>timezone</span><span class=o>.</span><span class=n>utc</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=n>expires_delta</span> <span class=ow>or</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>minutes</span><span class=o>=</span><span class=n>ACCESS_TOKEN_EXPIRE_MINUTES</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>to_encode</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;sub&#34;</span><span class=p>:</span> <span class=n>subject</span><span class=p>,</span> <span class=s2>&#34;exp&#34;</span><span class=p>:</span> <span class=n>expire</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>jwt</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=n>to_encode</span><span class=p>,</span> <span class=n>SECRET_KEY</span><span class=p>,</span> <span class=n>algorithm</span><span class=o>=</span><span class=n>ALGORITHM</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decode_token</span><span class=p>(</span><span class=n>token</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>jwt</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=n>token</span><span class=p>,</span> <span class=n>SECRET_KEY</span><span class=p>,</span> <span class=n>algorithms</span><span class=o>=</span><span class=p>[</span><span class=n>ALGORITHM</span><span class=p>])</span>
</span></span></code></pre></div><ol start=6><li>API dependencies and routes</li></ol><hr><p>Dependencies (current user) and small helper functions:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># app/api/deps.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>Depends</span><span class=p>,</span> <span class=n>HTTPException</span><span class=p>,</span> <span class=n>status</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi.security</span> <span class=kn>import</span> <span class=n>OAuth2PasswordBearer</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.orm</span> <span class=kn>import</span> <span class=n>Session</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>jose</span> <span class=kn>import</span> <span class=n>JWTError</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app.db.session</span> <span class=kn>import</span> <span class=n>get_db</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app.models.user</span> <span class=kn>import</span> <span class=n>User</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app.core.security</span> <span class=kn>import</span> <span class=n>verify_password</span><span class=p>,</span> <span class=n>decode_token</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>oauth2_scheme</span> <span class=o>=</span> <span class=n>OAuth2PasswordBearer</span><span class=p>(</span><span class=n>tokenUrl</span><span class=o>=</span><span class=s2>&#34;token&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_user_by_username</span><span class=p>(</span><span class=n>db</span><span class=p>:</span> <span class=n>Session</span><span class=p>,</span> <span class=n>username</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>User</span> <span class=o>|</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>db</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>User</span><span class=p>)</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>User</span><span class=o>.</span><span class=n>username</span> <span class=o>==</span> <span class=n>username</span><span class=p>)</span><span class=o>.</span><span class=n>first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>authenticate_user</span><span class=p>(</span><span class=n>db</span><span class=p>:</span> <span class=n>Session</span><span class=p>,</span> <span class=n>username</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>password</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>User</span> <span class=o>|</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>user</span> <span class=o>=</span> <span class=n>get_user_by_username</span><span class=p>(</span><span class=n>db</span><span class=p>,</span> <span class=n>username</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>user</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>verify_password</span><span class=p>(</span><span class=n>password</span><span class=p>,</span> <span class=n>user</span><span class=o>.</span><span class=n>hashed_password</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>user</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_current_user</span><span class=p>(</span><span class=n>token</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>oauth2_scheme</span><span class=p>),</span> <span class=n>db</span><span class=p>:</span> <span class=n>Session</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>get_db</span><span class=p>))</span> <span class=o>-&gt;</span> <span class=n>User</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=n>decode_token</span><span class=p>(</span><span class=n>token</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>username</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;sub&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>username</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>401</span><span class=p>,</span> <span class=n>detail</span><span class=o>=</span><span class=s2>&#34;Invalid token payload&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=n>JWTError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>401</span><span class=p>,</span> <span class=n>detail</span><span class=o>=</span><span class=s2>&#34;Invalid or expired token&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>user</span> <span class=o>=</span> <span class=n>get_user_by_username</span><span class=p>(</span><span class=n>db</span><span class=p>,</span> <span class=n>username</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>user</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>404</span><span class=p>,</span> <span class=n>detail</span><span class=o>=</span><span class=s2>&#34;User not found&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>user</span>
</span></span></code></pre></div><p>Auth and user routes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># app/api/routes/auth.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>timedelta</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>APIRouter</span><span class=p>,</span> <span class=n>Depends</span><span class=p>,</span> <span class=n>HTTPException</span><span class=p>,</span> <span class=n>status</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi.security</span> <span class=kn>import</span> <span class=n>OAuth2PasswordRequestForm</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.orm</span> <span class=kn>import</span> <span class=n>Session</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app.api.deps</span> <span class=kn>import</span> <span class=n>authenticate_user</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app.db.session</span> <span class=kn>import</span> <span class=n>get_db</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app.schemas.user</span> <span class=kn>import</span> <span class=n>Token</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app.core.security</span> <span class=kn>import</span> <span class=n>create_access_token</span><span class=p>,</span> <span class=n>ACCESS_TOKEN_EXPIRE_MINUTES</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>router</span> <span class=o>=</span> <span class=n>APIRouter</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@router.post</span><span class=p>(</span><span class=s2>&#34;/token&#34;</span><span class=p>,</span> <span class=n>response_model</span><span class=o>=</span><span class=n>Token</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>login</span><span class=p>(</span><span class=n>form_data</span><span class=p>:</span> <span class=n>OAuth2PasswordRequestForm</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(),</span> <span class=n>db</span><span class=p>:</span> <span class=n>Session</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>get_db</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=n>user</span> <span class=o>=</span> <span class=n>authenticate_user</span><span class=p>(</span><span class=n>db</span><span class=p>,</span> <span class=n>form_data</span><span class=o>.</span><span class=n>username</span><span class=p>,</span> <span class=n>form_data</span><span class=o>.</span><span class=n>password</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>user</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>status_code</span><span class=o>=</span><span class=n>status</span><span class=o>.</span><span class=n>HTTP_401_UNAUTHORIZED</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>detail</span><span class=o>=</span><span class=s2>&#34;Incorrect username or password&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>headers</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;WWW-Authenticate&#34;</span><span class=p>:</span> <span class=s2>&#34;Bearer&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>access_token_expires</span> <span class=o>=</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>minutes</span><span class=o>=</span><span class=n>ACCESS_TOKEN_EXPIRE_MINUTES</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>token</span> <span class=o>=</span> <span class=n>create_access_token</span><span class=p>(</span><span class=n>subject</span><span class=o>=</span><span class=n>user</span><span class=o>.</span><span class=n>username</span><span class=p>,</span> <span class=n>expires_delta</span><span class=o>=</span><span class=n>access_token_expires</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;access_token&#34;</span><span class=p>:</span> <span class=n>token</span><span class=p>,</span> <span class=s2>&#34;token_type&#34;</span><span class=p>:</span> <span class=s2>&#34;bearer&#34;</span><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># app/api/routes/users.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>APIRouter</span><span class=p>,</span> <span class=n>Depends</span><span class=p>,</span> <span class=n>HTTPException</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.orm</span> <span class=kn>import</span> <span class=n>Session</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app.api.deps</span> <span class=kn>import</span> <span class=n>get_current_user</span><span class=p>,</span> <span class=n>get_user_by_username</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app.db.session</span> <span class=kn>import</span> <span class=n>get_db</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app.models.user</span> <span class=kn>import</span> <span class=n>User</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app.schemas.user</span> <span class=kn>import</span> <span class=n>UserCreate</span><span class=p>,</span> <span class=n>UserRead</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app.core.security</span> <span class=kn>import</span> <span class=n>hash_password</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>router</span> <span class=o>=</span> <span class=n>APIRouter</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@router.post</span><span class=p>(</span><span class=s2>&#34;/users&#34;</span><span class=p>,</span> <span class=n>response_model</span><span class=o>=</span><span class=n>UserRead</span><span class=p>,</span> <span class=n>status_code</span><span class=o>=</span><span class=mi>201</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_user</span><span class=p>(</span><span class=n>payload</span><span class=p>:</span> <span class=n>UserCreate</span><span class=p>,</span> <span class=n>db</span><span class=p>:</span> <span class=n>Session</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>get_db</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=n>exists</span> <span class=o>=</span> <span class=n>get_user_by_username</span><span class=p>(</span><span class=n>db</span><span class=p>,</span> <span class=n>payload</span><span class=o>.</span><span class=n>username</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>exists</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>400</span><span class=p>,</span> <span class=n>detail</span><span class=o>=</span><span class=s2>&#34;Username already taken&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>user</span> <span class=o>=</span> <span class=n>User</span><span class=p>(</span><span class=n>username</span><span class=o>=</span><span class=n>payload</span><span class=o>.</span><span class=n>username</span><span class=p>,</span> <span class=n>hashed_password</span><span class=o>=</span><span class=n>hash_password</span><span class=p>(</span><span class=n>payload</span><span class=o>.</span><span class=n>password</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>refresh</span><span class=p>(</span><span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>user</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@router.get</span><span class=p>(</span><span class=s2>&#34;/me&#34;</span><span class=p>,</span> <span class=n>response_model</span><span class=o>=</span><span class=n>UserRead</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>read_me</span><span class=p>(</span><span class=n>current_user</span><span class=p>:</span> <span class=n>User</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>get_current_user</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>current_user</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># app/api/routes/health.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>APIRouter</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>router</span> <span class=o>=</span> <span class=n>APIRouter</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@router.get</span><span class=p>(</span><span class=s2>&#34;/healthz&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>healthz</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;ok&#34;</span><span class=p>}</span>
</span></span></code></pre></div><ol start=7><li>FastAPI application entrypoint</li></ol><hr><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># app/main.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app.db.base</span> <span class=kn>import</span> <span class=n>Base</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app.db.session</span> <span class=kn>import</span> <span class=n>engine</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app.api.routes</span> <span class=kn>import</span> <span class=n>auth</span><span class=p>,</span> <span class=n>users</span><span class=p>,</span> <span class=n>health</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Create tables</span>
</span></span><span class=line><span class=cl><span class=n>Base</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>create_all</span><span class=p>(</span><span class=n>bind</span><span class=o>=</span><span class=n>engine</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Mount routers</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>include_router</span><span class=p>(</span><span class=n>auth</span><span class=o>.</span><span class=n>router</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;auth&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>include_router</span><span class=p>(</span><span class=n>users</span><span class=o>.</span><span class=n>router</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;users&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>include_router</span><span class=p>(</span><span class=n>health</span><span class=o>.</span><span class=n>router</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;health&#34;</span><span class=p>])</span>
</span></span></code></pre></div><ol start=8><li>Try it out</li></ol><hr><p>Run the app (from the project root):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>uvicorn app.main:app --reload --host 0.0.0.0 --port <span class=m>8000</span>
</span></span></code></pre></div><p>Option A — Swagger UI (easiest)</p><ul><li>Open http://127.0.0.1:8000/docs</li><li>POST /users to register a user (username + password)</li><li>POST /token to get an access token</li><li>Click “Authorize”, paste <code>Bearer &lt;the_token></code></li><li>GET /me to verify it returns your user</li></ul><p>Option B — curl (robust, copy‑paste safe)
To avoid shell quoting/wrapping issues, send JSON from a file and use urlencoded helpers:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1) Register user</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;{&#34;username&#34;:&#34;alice&#34;,&#34;password&#34;:&#34;S3curePass!&#34;}&#39;</span> &gt; user.json
</span></span><span class=line><span class=cl>curl -sS -i -X POST http://127.0.0.1:8000/users <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -H <span class=s1>&#39;Content-Type: application/json&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --data-binary @user.json
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2) Get token (form-url-encoded)</span>
</span></span><span class=line><span class=cl><span class=nv>TOKEN</span><span class=o>=</span><span class=k>$(</span>curl -sS -X POST http://127.0.0.1:8000/token <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -H <span class=s1>&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --data-urlencode <span class=s1>&#39;username=alice&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --data-urlencode <span class=s1>&#39;password=S3curePass!&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=p>|</span> jq -r .access_token<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3) Call protected route</span>
</span></span><span class=line><span class=cl>curl -sS -i http://127.0.0.1:8000/me -H <span class=s2>&#34;Authorization: Bearer </span><span class=nv>$TOKEN</span><span class=s2>&#34;</span>
</span></span></code></pre></div><p>Notes</p><ul><li>If you see “Invalid HTTP request received”, your curl command likely broke across lines or used smart quotes. Use the file + <code>--data-binary</code> approach above.</li><li>If username is taken, register a different one (e.g., <code>alice2</code>).</li><li>If you don’t have <code>jq</code>, you can copy the token manually from the JSON response, or extract it with Python: <code>python -c "import sys,json;print(json.load(sys.stdin)['access_token'])"</code>.</li><li>Make sure <code>python-multipart</code> is installed; it’s required for the <code>/token</code> form endpoint.</li></ul><p>Option C — Postman (GUI)</p><ul><li>Register (POST /users):<ul><li>Body: raw → JSON</li><li>Content-Type: application/json</li><li>Payload: <code>{ "username": "alice", "password": "S3curePass!" }</code></li></ul></li><li>Login (POST /token):<ul><li>Body: x-www-form-urlencoded (not raw JSON)</li><li>Keys: <code>username=alice</code>, <code>password=S3curePass!</code></li></ul></li><li>Protected (GET /me):<ul><li>Authorization tab → Type: Bearer Token → paste the token (no quotes)</li></ul></li></ul><p>Optional: import the Postman collection and use it directly: <code>/postman/fastapi-jwt-auth.postman_collection.json</code>.</p><p>Option D — HTTPie (nice DX)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Register</span>
</span></span><span class=line><span class=cl>http POST :8000/users <span class=nv>username</span><span class=o>=</span>alice <span class=nv>password</span><span class=o>=</span>S3curePass!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Login</span>
</span></span><span class=line><span class=cl>http -f POST :8000/token <span class=nv>username</span><span class=o>=</span>alice <span class=nv>password</span><span class=o>=</span>S3curePass! <span class=p>|</span> jq
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Me</span>
</span></span><span class=line><span class=cl><span class=nv>TOKEN</span><span class=o>=</span><span class=k>$(</span>http -f POST :8000/token <span class=nv>username</span><span class=o>=</span>alice <span class=nv>password</span><span class=o>=</span>S3curePass! <span class=p>|</span> jq -r .access_token<span class=k>)</span>
</span></span><span class=line><span class=cl>http GET :8000/me <span class=s2>&#34;Authorization:Bearer </span><span class=nv>$TOKEN</span><span class=s2>&#34;</span>
</span></span></code></pre></div><ol start=9><li>Production notes</li></ol><hr><ul><li>Secrets: Never hardcode <code>SECRET_KEY</code>. Read it from environment variables or a secret manager.</li><li>Token lifetime: Adjust <code>ACCESS_TOKEN_EXPIRE_MINUTES</code> based on risk. Consider short‑lived access tokens with refresh tokens.</li><li>HTTPS and reverse proxy: Put FastAPI behind Nginx/Traefik and enforce HTTPS. See the deployment guide: /2025/08/deploy-fastapi-ubuntu-24-04-gunicorn-nginx-certbot.html.</li><li>Password policy: Enforce minimum length and complexity. Consider rate‑limiting login attempts.</li><li>Database: For PostgreSQL, change the <code>SQLALCHEMY_DATABASE_URL</code> (e.g., <code>postgresql+psycopg://user:pass@host/db</code>). Use Alembic for migrations.</li><li>CORS/SPA: If used from a browser SPA, configure CORS properly and store tokens securely. For cookie‑based auth, consider <code>OAuth2PasswordBearer</code> alternatives with <code>httponly</code> cookies and CSRF protection.</li><li>Scopes/roles: FastAPI supports OAuth2 scopes; add them to tokens and check in dependencies.</li><li>Testing: Use <code>httpx.AsyncClient</code> and <code>pytest</code> to cover login and protected routes.</li></ul><p>Systemd tip (prod): set env vars in the unit file instead of <code>.env</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>Environment</span><span class=o>=</span><span class=s>&#34;SECRET_KEY=your-strong-secret&#34;</span>
</span></span><span class=line><span class=cl><span class=na>Environment</span><span class=o>=</span><span class=s>&#34;ACCESS_TOKEN_EXPIRE_MINUTES=30&#34;</span>
</span></span></code></pre></div><h2 id=wrapup>Wrap‑up</h2><p>You now have a working JWT‑based login using the OAuth2 Password flow in FastAPI with Pydantic v2 and SQLAlchemy 2.0. The example is deliberately small but production‑leaning: it hashes passwords, issues signed tokens, and protects endpoints with a simple dependency. From here, add what you need—refresh tokens, roles/scopes, social logins, and migrations—then deploy behind Nginx with HTTPS.</p></p><div class="bg-gray-100 dark:bg-gray-800 p-4 my-8 rounded"><h2 class="text-lg font-semibold mb-2">📌 Read Also</h2><ul class="list-disc list-inside"><li><a href=/2025/08/deploy-fastapi-ubuntu-24-04-gunicorn-nginx-certbot.html class="text-blue-600 dark:text-blue-400 hover:underline">Deploy FastAPI on Ubuntu 24.04: Gunicorn + Nginx + Certbot (HTTPS)</a></li></ul></div><div class="hidden lg:block"><div class="my-8 py-6 border-t border-b border-gray-200 dark:border-gray-700"><div class="max-w-4xl mx-auto"><div class="text-center mb-3"><span class="text-xs text-gray-400 dark:text-gray-500 uppercase tracking-wide font-medium">Advertisement</span></div><div class="flex justify-center min-h-[90px]"><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-3149036684216973 data-ad-slot=3879195288 data-ad-format=auto data-full-width-responsive=true></ins></div><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div></div><div class="block lg:hidden my-8 px-2 mb-10"><div class="text-center mb-2"><span class="text-xs text-gray-400 dark:text-gray-500 uppercase tracking-wide font-medium">Advertisement</span></div><div class="flex justify-center"><div class="bg-white dark:bg-gray-800 rounded-lg p-2 shadow-sm border border-gray-200 dark:border-gray-700"><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-3149036684216973 data-ad-slot=3879195288 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div></div></article><aside class=space-y-10><div><h3 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">Popular Posts</h3><ul class="space-y-3 list-disc list-outside pl-5 text-sm text-gray-800 dark:text-gray-200"><li><a href=/2025/08/uninstall-docker-ubuntu-24-04-clean-removal.html class="hover:text-[#0f7ea9] transition">Uninstall Docker on Ubuntu 24.04: Complete Clean Removal</a></li><li><a href=/2025/08/what-are-passkeys-how-to-enable-google-apple-password-managers.html class="hover:text-[#0f7ea9] transition">What Are Passkeys? How to Enable Them on Google, Apple, and Password Managers (2025 Guide)</a></li><li><a href=/2025/08/phishing-signs-fake-email-examples-how-to-avoid.html class="hover:text-[#0f7ea9] transition">Phishing: Signs, Fake Email Examples, and How to Avoid Them (2025 Guide)</a></li><li><a href=/2025/08/fastapi-jwt-auth-oauth2-password-flow-pydantic-v2-sqlalchemy-2.html class="hover:text-[#0f7ea9] transition">FastAPI JWT Auth with OAuth2 Password Flow (Pydantic v2 + SQLAlchemy 2.0)</a></li><li><a href=/2025/08/install-ollama-openwebui-ubuntu-24-04.html class="hover:text-[#0f7ea9] transition">Install Ollama and Open WebUI on Ubuntu 24.04: Local AI (CPU/GPU)</a></li></ul></div><div class="hidden lg:block mt-8"><div class="sticky top-8"><div class="text-center mb-3"><span class="text-xs text-gray-400 dark:text-gray-500 uppercase tracking-wide font-medium">Advertisement</span></div><div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow duration-300 mx-auto w-[300px] min-h-[250px]"><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-3149036684216973 data-ad-slot=3879195288 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div></div></aside></div><section id=comments class=mt-12><script src=https://giscus.app/client.js data-repo=wikukarno/buanacoding data-repo-id=R_kgD0Oj4jAw data-category=General data-category-id=DIC_kwD0Oj4jA84Cr_fx data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></section><div class="fixed bottom-6 right-6 z-50 lg:hidden"><button id=share-toggle class="bg-[#0f7ea9] text-white p-3 rounded-full shadow-lg hover:bg-[#094d66] transition-all duration-300">
<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684 6.632 3.316m-6.632-6 6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"/></svg></button><div id=share-options class="hidden absolute bottom-16 right-0 bg-white dark:bg-gray-800 rounded-lg shadow-xl p-4 min-w-[200px] border border-gray-200 dark:border-gray-700"><div class=space-y-2><a href="https://twitter.com/intent/tweet?text=FastAPI+JWT+Auth+with+OAuth2+Password+Flow+%28Pydantic+v2+%2B+SQLAlchemy+2.0%29&url=https%3A%2F%2Fwww.buanacoding.com%2F2025%2F08%2Ffastapi-jwt-auth-oauth2-password-flow-pydantic-v2-sqlalchemy-2.html&via=buanacoding" target=_blank rel=noopener class="flex items-center p-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors"><svg class="w-4 h-4 mr-3" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
Twitter
</a><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.buanacoding.com%2F2025%2F08%2Ffastapi-jwt-auth-oauth2-password-flow-pydantic-v2-sqlalchemy-2.html" target=_blank rel=noopener class="flex items-center p-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors"><svg class="w-4 h-4 mr-3" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312.0 2.686.235 2.686.235v2.953H15.83c-1.491.0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
Facebook
</a><a href="https://wa.me/?text=FastAPI+JWT+Auth+with+OAuth2+Password+Flow+%28Pydantic+v2+%2B+SQLAlchemy+2.0%29%20https%3A%2F%2Fwww.buanacoding.com%2F2025%2F08%2Ffastapi-jwt-auth-oauth2-password-flow-pydantic-v2-sqlalchemy-2.html" target=_blank rel=noopener class="flex items-center p-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors"><svg class="w-4 h-4 mr-3" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198.0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479.0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87.0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86.0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64.0 5.122 1.03 6.988 2.898a9.825 9.825.0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815.0 0012.05.0C5.495.0.16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882.0 005.683 1.448h.005c6.554.0 11.89-5.335 11.893-11.893A11.821 11.821.0 0020.484 3.488"/></svg>
WhatsApp
</a><button onclick='copyToClipboard("https://www.buanacoding.com/2025/08/fastapi-jwt-auth-oauth2-password-flow-pydantic-v2-sqlalchemy-2.html")' class="flex items-center w-full p-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors">
<svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
Copy Link</button></div></div><div id=copy-toast class="hidden absolute bottom-16 right-0 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg text-sm">Link copied!</div></div><script>document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("share-toggle"),e=document.getElementById("share-options");t.addEventListener("click",function(){e.classList.toggle("hidden")}),document.addEventListener("click",function(n){!t.contains(n.target)&&!e.contains(n.target)&&e.classList.add("hidden")})});function copyToClipboard(e){navigator.clipboard.writeText(e).then(function(){showToast()}).catch(function(){const n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),showToast()})}function showToast(){const e=document.getElementById("copy-toast"),t=document.getElementById("share-options");t.classList.add("hidden"),e.classList.remove("hidden"),setTimeout(function(){e.classList.add("hidden")},2e3)}</script></div></main><div class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-white py-4 transition-colors duration-300"><div class="text-center space-x-4 text-sm font-medium"><a href=/about class="hover:text-cyan-500 dark:hover:text-cyan-400">About</a>
<span>-</span>
<a href=/contact class="hover:text-cyan-500 dark:hover:text-cyan-400">Contact</a>
<span>-</span>
<a href=/privacy-policy class="hover:text-cyan-500 dark:hover:text-cyan-400">Privacy Policy</a>
<span>-</span>
<a href=/disclaimer class="hover:text-cyan-500 dark:hover:text-cyan-400">Disclaimer</a></div></div><footer class="text-center text-sm text-gray-500 dark:text-gray-400 py-4 border-t border-gray-200 dark:border-gray-700">&copy; 2025 buanacoding.com &mdash; Crafted with ❤️ by <a href=https://www.wikukarno.com class="text-gray-500 dark:text-gray-400 hover:text-cyan-500 dark:hover:text-cyan-400" target=_blank>Wiku Karno</a></footer><button id=scrollToTop class="fixed bottom-6 right-6 bg-[#0f7ea9] hover:bg-cyan-600 text-white p-3 rounded-full shadow transition duration-300" aria-label="Scroll to top">
<svg fill="none" class="w-4 h-4" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/></svg></button><div id=google_translate_element style=display:none></div><script src=https://unpkg.com/feather-icons></script><script src=https://cdn.jsdelivr.net/npm/fuse.js@6.4.6></script><script>feather.replace();const btn=document.getElementById("scrollToTop"),html=document.documentElement,toggleBtn=document.getElementById("theme-toggle"),toggleBtnMobile=document.getElementById("theme-toggle-mobile"),iconSun=document.getElementById("icon-sun"),iconMoon=document.getElementById("icon-moon"),iconSunMobile=document.getElementById("icon-sun-mobile"),iconMoonMobile=document.getElementById("icon-moon-mobile");document.getElementById("menu-toggle")?.addEventListener("click",()=>{document.getElementById("mobile-menu")?.classList.toggle("hidden")}),btn.style.display="none",window.addEventListener("scroll",()=>{window.scrollY>300?btn.style.display="flex":btn.style.display="none"}),btn.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})});function updateIcons(e){iconSun.classList.toggle("hidden",!e),iconMoon.classList.toggle("hidden",e),iconSunMobile.classList.toggle("hidden",!e),iconMoonMobile.classList.toggle("hidden",e)}function setDarkMode(e){html.setAttribute("data-theme",e?"dark":"light"),localStorage.setItem("theme",e?"dark":"light"),updateIcons(e)}const userPref=localStorage.getItem("theme"),systemPref=window.matchMedia("(prefers-color-scheme: dark)").matches,isDark=userPref==="dark"||!userPref&&systemPref;setDarkMode(isDark),toggleBtn?.addEventListener("click",()=>{const e=html.getAttribute("data-theme")==="dark";setDarkMode(!e)}),toggleBtnMobile?.addEventListener("click",()=>{const e=html.getAttribute("data-theme")==="dark";setDarkMode(!e)}),document.querySelectorAll("pre").forEach(e=>{const t=document.createElement("button");t.innerHTML=`
      <span>Copy</span>
    `,t.className=`
    copy-btn absolute top-2 right-2
    text-xs px-2 py-1 rounded flex items-center gap-1
    transition-colors duration-200
    bg-gray-200 text-gray-800 hover:bg-gray-300
    dark:bg-white/10 dark:text-white dark:hover:bg-white/20
  `.trim();const n=document.createElement("div");n.className="relative",e.parentNode.insertBefore(n,e),n.appendChild(e),n.appendChild(t),t.addEventListener("click",()=>{const n=e.innerText;navigator.clipboard.writeText(n).then(()=>{t.querySelector("span").innerText="Copied!",setTimeout(()=>{t.querySelector("span").innerText="Copy"},2e3)})})});const openBtn=document.getElementById("openSearchModal"),closeBtn=document.getElementById("closeSearchModal"),modal=document.getElementById("searchModal");openBtn.addEventListener("click",()=>{console.log("Search modal opened"),modal.classList.remove("hidden"),document.getElementById("searchBox").focus()}),closeBtn.addEventListener("click",()=>{modal.classList.add("hidden")}),document.addEventListener("keydown",e=>{e.key==="Escape"&&modal.classList.add("hidden")}),fetch("/index.json").then(e=>e.json()).then(e=>{const n=new Fuse(e,{keys:["title","content"],threshold:.3}),s=document.getElementById("searchBox"),t=document.getElementById("results");s.addEventListener("input",function(e){const s=e.target.value.trim();if(s.length<2){t.innerHTML="";return}const o=n.search(s);o.length===0?t.innerHTML="<li class='px-4 py-2'>No results found.</li>":t.innerHTML=o.map(e=>`
                    <li class="px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                    <a href="${e.item.href}" class="block font-semibold text-gray-900 dark:text-white">${e.item.title}</a>
                  </li>
                  `).join("")})});const openBtnMobile=document.getElementById("openSearchModalMobile"),closeBtnMobile=document.getElementById("closeSearchModal"),modalMobile=document.getElementById("searchModal");openBtnMobile.addEventListener("click",()=>{console.log("Search modal opened (mobile)"),modalMobile.classList.remove("hidden"),document.getElementById("searchBox").focus()}),closeBtnMobile.addEventListener("click",()=>{modalMobile.classList.add("hidden")}),document.addEventListener("keydown",e=>{e.key==="Escape"&&modalMobile.classList.add("hidden")}),function(){function t(e,t){if(window.google&&window.google.translate&&window.google.translate.TranslateElement){e&&e();return}if(window.__gtReadyCallbacks=window.__gtReadyCallbacks||[],e&&window.__gtReadyCallbacks.push(e),window.__gtLoading)return;window.__gtLoading=!0,window.initGoogleTranslate=function(){try{new window.google.translate.TranslateElement({pageLanguage:"en",includedLanguages:"id",autoDisplay:!1},"google_translate_element")}catch{}(window.__gtReadyCallbacks||[]).forEach(function(e){try{e()}catch{}}),window.__gtReadyCallbacks=[]};var s,n=document.createElement("script");n.src="https://translate.google.com/translate_a/element.js?cb=initGoogleTranslate",n.defer=!0,s=!1,n.onerror=function(){s=!0,t&&t()},setTimeout(function(){(!window.google||!window.google.translate)&&(s=!0,t&&t())},4e3),document.head.appendChild(n)}function n(e,t){document.cookie=e+"="+t+"; path=/; expires="+new Date(Date.now()+365*24*3600*1e3).toUTCString()}function e(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/"}function s(){if(document.getElementById("translate-fallback"))return;var e=document.createElement("div");e.id="translate-fallback",e.style.cssText="position:fixed;bottom:12px;left:50%;transform:translateX(-50%);z-index:9999;background:#111827;color:#fff;padding:10px 14px;border-radius:10px;box-shadow:0 4px 16px rgba(0,0,0,0.25);display:flex;gap:10px;align-items:center;",e.innerHTML='<span style="font-size:13px">Auto-translate tidak tersedia di perangkat ini.</span><button id="btnTryId" style="background:#0ea5e9;color:#fff;border:none;padding:6px 10px;border-radius:8px;font-size:12px">Coba versi Indonesia</button><button id="btnCloseTf" style="background:transparent;color:#fff;border:1px solid #fff3;padding:6px 10px;border-radius:8px;font-size:12px">Tutup</button>',document.body.appendChild(e),document.getElementById("btnCloseTf").onclick=function(){e.remove()},document.getElementById("btnTryId").onclick=function(){var t=new URL(location.href),e=location.pathname;e.startsWith("/id/")||(t.pathname="/id"+(e.startsWith("/")?e:"/"+e)),fetch(t,{method:"HEAD"}).then(function(e){e.ok?location.href=t:location.href="/id/"}).catch(function(){location.href="/id/"})}}function o(e){t(function(){var t=document.querySelector(".goog-te-combo");t?(t.value=e,t.dispatchEvent(new Event("change"))):(n("googtrans","/en/"+e),location.reload())},s)}function i(){e("googtrans"),e("GOOGTRANS")}document.querySelectorAll(".js-lang-link").forEach(function(e){e.addEventListener("click",function(t){var n=e.getAttribute("data-lang"),s=e.getAttribute("data-has-trans")==="true";if(n==="en"){i();return}s||(t.preventDefault(),o(n))})})}()</script></body></html>